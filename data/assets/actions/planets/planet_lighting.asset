local function illuminationCommand(node, global)
  local commandString = "local node = '" .. node .. "'\n"
  if (node == "Current Focus") then
    commandString = "local node = openspace.navigation.getNavigationState().Anchor\n"
  end
  if (global) then
    commandString = commandString .. [[
if (openspace.hasProperty("Scene."..node..".Renderable.UseAccurateNormals")) then
  local list = openspace.getProperty("Scene." .. node .. ".Renderable.Layers.NightLayers.*.Enabled")
  if (#list > 0) then
    openspace.setPropertyValue("Scene." .. node .. ".Renderable.Layers.NightLayers.*.Enabled", false)
  else
    openspace.setPropertyValueSingle("Scene." .. node .. ".Renderable.PerformShading", false)
  end
  if openspace.hasSceneGraphNode(node .. "Atmosphere") then
    openspace.setPropertyValueSingle("Scene." .. node .. "Atmosphere.Renderable.SunFollowingCamera", true)
  end
  if openspace.hasProperty("Scene." .. node .. ".Renderable.ShadowsComponent.DistanceFraction") then
    openspace.setPropertyValueSingle("Scene." .. node .. ".Renderable.ShadowsComponent.DistanceFraction", 3000)
  end
else
  openspace.printWarning("Illumination action only available for globes")
end]]
  else
    --todo @micahnyc this 40 wont do once we have more rings
    commandString = commandString .. [[if (openspace.hasProperty("Scene."..node..".Renderable.UseAccurateNormals")) then
local list = openspace.getProperty("Scene." .. node .. ".Renderable.Layers.NightLayers.*.Enabled")
if (#list > 0) then
  openspace.setPropertyValue(list[1], true)
else
  openspace.setPropertyValueSingle("Scene." .. node .. ".Renderable.PerformShading", true)
end
if openspace.hasSceneGraphNode(node .. "Atmosphere") then
  openspace.setPropertyValueSingle("Scene." .. node .. "Atmosphere.Renderable.SunFollowingCamera", false)
end
if openspace.hasProperty("Scene." .. node .. ".Renderable.ShadowsComponent.DistanceFraction") then
  openspace.setPropertyValueSingle("Scene." .. node .. ".Renderable.ShadowsComponent.DistanceFraction", 40)
end
else
  openspace.printWarning("Illumination action only available for globes")
end]]
  end
  return commandString
end

local function illuminationAction(node, node_lower, global)
  local actionString = "_standard_illumination"
  local actionName = "standard illumination"
  local actionCommand = illuminationCommand(node, global)
  if (global) then
    actionString = "_global_illumination"
    actionName = "global illumination"
    actionCommand = illuminationCommand(node, global)
  end

  local action = {
    Identifier = "os." .. string.gsub(node_lower, "%s+", "") .. actionString,
    Name = node .. " " .. actionName,
    Command = actionCommand,
    Documentation = "Enables " .. string.lower(actionName) .. " for" .. node,
    GuiPath = "/Solar System/" .. node,
    IsLocal = true
  }
  return action
end

local current_focus_global = illuminationAction("Current Focus", "current_focus", true)
local current_focus_standard = illuminationAction("Current Focus", "current_focus", false)

local earth_global = illuminationAction("Earth", "earth", true)
local earth_standard = illuminationAction("Earth", "earth", false)

local mars_global = illuminationAction("Mars", "mars", true)
local mars_standard = illuminationAction("Mars", "mars", false)

local venus_global = illuminationAction("Venus", "venus", true)
local venus_standard = illuminationAction("Venus", "venus", false)

local titan_global = illuminationAction("Titan", "titan", true)
local titan_standard = illuminationAction("Titan", "titan", false)

local saturn_global = illuminationAction("Saturn", "saturn", true)
local saturn_standard = illuminationAction("Saturn", "saturn", false)


-- handling Earth special
-- if we have #2258 we can do all globes with night layers instead of just earth
-- if we have #1826 we can do the default night layer instead of the first
local all_globes_global_illumination = {
  Identifier = "os.all_globes_global_illumination",
  Name = "All globes global illumination",
  Command = [[
    openspace.setPropertyValue("{planet_solarSystem}.Renderable.PerformShading", false)
    openspace.setPropertyValue("{moon_solarSystem}.Renderable.PerformShading", false)
    openspace.setPropertyValue("Scene.*Atmosphere.Renderable.SunFollowingCamera", true)
    openspace.setPropertyValue("Scene.*.Renderable.ShadowsComponent.DistanceFraction", 3000)
    openspace.setPropertyValue("Scene.Earth.Renderable.Layers.NightLayers.Earth_at_Night_2012.Enabled", false)
  ]],
  Documentation = "Enables global illumination for all globes",
  GuiPath = "/Solar System",
  IsLocal = true
}

local all_globes_standard_illumination = {
  Identifier = "os.all_globes_standard_illumination",
  Name = "All globes standard illumination",
  Command = [[
    openspace.setPropertyValue("{planet_solarSystem}.Renderable.PerformShading", true)
    openspace.setPropertyValue("{moon_solarSystem}.Renderable.PerformShading", true)
    openspace.setPropertyValue("Scene.*Atmosphere.Renderable.SunFollowingCamera", false)
    openspace.setPropertyValue("Scene.*.Renderable.ShadowsComponent.DistanceFraction", 40)
    openspace.setPropertyValueSingle("Scene.Earth.Renderable.Layers.NightLayers.Earth_at_Night_2012.Enabled", true)
    openspace.setPropertyValueSingle("Scene.Earth.Renderable.PerformShading", false)
  ]],
  Documentation = "Disables global illumination for all globes",
  GuiPath = "/Solar System",
  IsLocal = true
}


asset.onInitialize(function()
  openspace.action.registerAction(current_focus_global)
  openspace.action.registerAction(current_focus_standard)
  openspace.action.registerAction(earth_global)
  openspace.action.registerAction(earth_standard)
  openspace.action.registerAction(mars_global)
  openspace.action.registerAction(mars_standard)
  openspace.action.registerAction(venus_global)
  openspace.action.registerAction(venus_standard)
  openspace.action.registerAction(titan_global)
  openspace.action.registerAction(titan_standard)
  openspace.action.registerAction(saturn_global)
  openspace.action.registerAction(saturn_standard)
  openspace.action.registerAction(all_globes_global_illumination)
  openspace.action.registerAction(all_globes_standard_illumination)
end)

asset.onDeinitialize(function()
  openspace.action.removeAction(all_globes_global_illumination)
  openspace.action.removeAction(all_globes_standard_illumination)
  openspace.action.removeAction(saturn_standard)
  openspace.action.removeAction(saturn_global)
  openspace.action.removeAction(titan_standard)
  openspace.action.removeAction(titan_global)
  openspace.action.removeAction(venus_standard)
  openspace.action.removeAction(venus_global)
  openspace.action.removeAction(mars_standard)
  openspace.action.removeAction(mars_global)
  openspace.action.removeAction(earth_standard)
  openspace.action.removeAction(earth_global)
  openspace.action.removeAction(current_focus_standard)
  openspace.action.removeAction(current_focus_global)
end)

asset.export("current_focus_global", current_focus_global.Identifier)
asset.export("current_focus_standard", current_focus_standard.Identifier)
asset.export("earth_global", earth_global.Identifier)
asset.export("earth_standard", earth_standard.Identifier)
asset.export("mars_global", mars_global.Identifier)
asset.export("mars_standard", mars_standard.Identifier)
asset.export("venus_global", venus_global.Identifier)
asset.export("venus_standard", venus_standard.Identifier)
asset.export("titan_global", titan_global.Identifier)
asset.export("titan_standard", titan_standard.Identifier)
asset.export("saturn_global", saturn_global.Identifier)
asset.export("titan_standard", saturn_standard.Identifier)
asset.export("all_globes_global_illumination", all_globes_global_illumination.Identifier)
asset.export("all_globes_standard_illumination", all_globes_standard_illumination.Identifier)
