local assetHelper = asset.require('util/asset_helper')
local sceneHelper = asset.require('util/scene_helper')
local propertyHelper = asset.require('util/property_helper')

-- Specifying which other assets should be loaded in this scene
asset.require('spice/base')
assetHelper.requestAll(asset, 'scene/solarsystem/sun')

-- Load default key bindings applicable to most scenes
asset.require('util/default_keybindings')
asset.require('util/default_dashboard')
asset.require('util/default_joystick')
assetHelper.requestAll(asset, 'scene/digitaluniverse')
asset.request('customization/globebrowsing')

-- Would like to do asset.request('./planets') but Curiosity Kernels
-- seem to conflict with Jupiter moon's kernels.
-- Therefore, we manually include the whole solar system except Jupiter's moons for now:

asset.request('scene/solarsystem/planets/mercury/mercury')

asset.request('scene/solarsystem/planets/venus/venus')

asset.request('scene/solarsystem/planets/earth/earth')
asset.request('scene/solarsystem/planets/earth/atmosphere')
asset.request('scene/solarsystem/planets/earth/markers')
asset.request('scene/solarsystem/planets/earth/moon/moon')

asset.request('scene/solarsystem/planets/mars/mars')
asset.request('scene/solarsystem/planets/mars/atmosphere')

--asset.request('scene/solarsystem/planets/jupiter/jupiter')

asset.request('scene/solarsystem/planets/saturn/saturn')
asset.request('scene/solarsystem/planets/saturn/major_moons')

asset.request('scene/solarsystem/planets/uranus/uranus')
asset.request('scene/solarsystem/planets/uranus/major_moons')

asset.request('scene/solarsystem/planets/neptune/neptune')
asset.request('scene/solarsystem/planets/neptune/major_moons')

-- Done including planets + moons.

local MSLAsset = asset.require('scene/solarsystem/planets/mars/rovers/curiosity')

asset.onInitialize(function ()
    openspace.setPropertyValueSingle(
        'Scene.Mars.RenderableGlobe.Layers.ColorLayers.MSL_Gale_DEM_Mosaic_1m_v3.Enabled',
        true
    )
    openspace.setPropertyValueSingle(
        'Scene.Mars.RenderableGlobe.Layers.HeightLayers.MSL_Gale_DEM_Mosaic_1m_v3.Enabled',
        true
    )

    openspace.setPropertyValueSingle(
        'Scene.Mars.RenderableGlobe.Layers.ColorLayers.MSL_Gale_DEM_Mosaic_1m_v3.BlendMode',
        1 -- Multiply
    );

    --openspace.time.setTime(openspace.time.currentWallTime())

    --selfie
    --openspace.time.setTime("2018-01-23T12:28:28")
    --Landing
    --openspace.time.setTime("2012-08-06T06:30:28")
    --openspace.time.setTime("2013-07-05T03:04:09")
    --moving
    --openspace.time.setTime("2012-08-28T18:20:09")
    --moving longer forward in time
    openspace.time.setTime("2013-08-22T05:44:00")

    openspace.setDefaultGuiSorting()

    openspace.globebrowsing.loadWMSServersFromFile(
        openspace.absPath("${DATA}/globebrowsing_servers.lua")
    )

    openspace.markInterestingNodes({
        "Earth", "Mars", "Curiosity", "HeightMap", "Body_staticParts_2"
    })

    openspace.addVirtualProperty(
        "BoolProperty",
        "Show Trails",
        "Scene.*Trail.renderable.Enabled",
        "Disable or enable all trails of the scene at the same time",
        true,
        nil,
        nil
    )

    openspace.navigation.setCameraState({
        Anchor = MSLAsset.CuriosityModel.Identifier,
        Position = { 10.0, 10.0, 10.0 },
        Rotation = { 0.0, -0.0, 0.0, 0.0 },
    })
    openspace.globebrowsing.goToGeo(58.5877, 16.1924, 20000000)
end)


asset.onDeinitialize(function ()

    openspace.removeVirtualProperty("*Trail.renderable.Enabled")

    openspace.removeInterestingNodes({
        "Earth", "Mars", "Curiosity", "HeightMap", "Body_staticParts_2"
    })
end)