local mercury = asset.require('scene/solarsystem/planets/mercury/transforms')
local venus = asset.require('scene/solarsystem/planets/venus/transforms')
local mars = asset.require('scene/solarsystem/planets/mars/transforms')
local jupiter = asset.require('scene/solarsystem/planets/jupiter/transforms')
local saturn = asset.require('scene/solarsystem/planets/saturn/transforms')

local textures = asset.syncedResource({
  Name = "Night Sky Planet Textures",
  Type = "HttpSynchronization",
  Identifier = "night_sky_planet_textures",
  Version = 1
})

local Mercury = {
  Identifier = "NightSkyMercury",
  Parent = mercury.MercuryBarycenter.Identifier,
  Renderable = {
    Type = "RenderablePlaneImageLocal",
    Billboard = true,
    Enabled = asset.enabled,
    Size = 2439700 * 500,
    Texture = textures .. "glare.png",
    MultiplyColor = { 0.608, 0.604, 0.455 },
    DimInAtmosphere = true,
    RenderBinMode = "PostDeferredTransparent"
  },
  Tag = { "nightsky_billboard"},
  GUI = {
    Name = "Night Sky Mercury",
    Path = "/Other/Night Sky/Planets"
  }
}

local Venus = {
  Identifier = "NightSkyVenus",
  Parent = venus.VenusBarycenter.Identifier,
  Renderable = {
    Type = "RenderablePlaneImageLocal",
    Enabled = asset.enabled,
    Billboard = true,
    Size = 6051900 * 500,
    Texture = textures .. "glare.png",
    MultiplyColor = { 0.608, 0.604, 0.455 },
    DimInAtmosphere = true,
    RenderBinMode = "PostDeferredTransparent"
  },
  Tag = { "nightsky_billboard"},
  GUI = {
    Name = "Night Sky Venus",
    Path = "/Other/Night Sky/Planets"
  }
}

local Mars = {
  Identifier = "NightSkyMars",
  Parent = mars.MarsBarycenter.Identifier,
  Renderable = {
    Type = "RenderablePlaneImageLocal",
    Enabled = asset.enabled,
    Billboard = true,
    Size = 3396190 * 1000,
    Texture = textures .. "glare.png",
    MultiplyColor = { 0.756, 0.267, 0.054 },
    DimInAtmosphere = true,
    RenderBinMode = "PostDeferredTransparent"
  },
  Tag = { "nightsky_billboard"},
  GUI = {
    Name = "Night Sky Mars",
    Path = "/Other/Night Sky/Planets"
  }
}

local Jupiter = {
  Identifier = "NightSkyJupiter",
  Parent = jupiter.JupiterBarycenter.Identifier,
  Renderable = {
    Type = "RenderablePlaneImageLocal",
    Enabled = asset.enabled,
    Billboard = true,
    Size = 71492000 * 400,
    Texture = textures .. "glare.png",
    MultiplyColor = { 0.608, 0.604, 0.455 },
    DimInAtmosphere = true,
    RenderBinMode = "PostDeferredTransparent"
  },
  Tag = { "nightsky_billboard"},
  GUI = {
    Name = "Night Sky Jupiter",
    Path = "/Other/Night Sky/Planets"
  }
}

local Saturn = {
  Identifier = "NightSkySaturn",
  Parent = saturn.SaturnBarycenter.Identifier,
  Renderable = {
    Type = "RenderablePlaneImageLocal",
    Enabled = asset.enabled,
    Billboard = true,
    Size = 60268000 * 500,
    Texture = textures .. "glare.png",
    MultiplyColor = { 0.608, 0.604, 0.455 },
    DimInAtmosphere = true,
    RenderBinMode = "PostDeferredTransparent"
  },
  Tag = { "nightsky_billboard"},
  GUI = {
    Name = "Night Sky Saturn",
    Path = "/Other/Night Sky/Planets"
  }
}

local showAction = {
  Identifier = "os.nightsky.show_night_sky_planets",
  Name = "Show night sky planets",
  Command = [[
    openspace.setPropertyValueSingle('Scene.NightSkyMercury.Renderable.Enabled', true);
    openspace.setPropertyValueSingle('Scene.NightSkyVenus.Renderable.Enabled', true);
    openspace.setPropertyValueSingle('Scene.NightSkyMars.Renderable.Enabled', true);
    openspace.setPropertyValueSingle('Scene.NightSkyJupiter.Renderable.Enabled', true);
    openspace.setPropertyValueSingle('Scene.NightSkySaturn.Renderable.Enabled', true);
    openspace.setPropertyValueSingle('Scene.NightSkyMercury.Renderable.Fade', 0.0);
    openspace.setPropertyValueSingle('Scene.NightSkyVenus.Renderable.Fade', 0.0);
    openspace.setPropertyValueSingle('Scene.NightSkyMars.Renderable.Fade', 0.0);
    openspace.setPropertyValueSingle('Scene.NightSkyJupiter.Renderable.Fade', 0.0);
    openspace.setPropertyValueSingle('Scene.NightSkySaturn.Renderable.Fade', 0.0);
    openspace.setPropertyValueSingle('Scene.NightSkyMercury.Renderable.Fade', 1.0, 0.25);
    openspace.setPropertyValueSingle('Scene.NightSkyVenus.Renderable.Fade', 1.0, 0.25);
    openspace.setPropertyValueSingle('Scene.NightSkyMars.Renderable.Fade', 1.0, 0.25);
    openspace.setPropertyValueSingle('Scene.NightSkyJupiter.Renderable.Fade', 1.0, 0.25);
    openspace.setPropertyValueSingle('Scene.NightSkySaturn.Renderable.Fade', 1.0, 0.25);
  ]],
  Documentation = "Show night sky versions of the planets",
  GuiPath = "/Night Sky/Planets",
  IsLocal = false
}

local hideAction = {
  Identifier = "os.nightsky.hide_night_sky_planets",
  Name = "Hide night sky planets",
  Command = [[
    openspace.setPropertyValueSingle('Scene.NightSkyMercury.Renderable.Fade', 0.0, 1.0);
    openspace.setPropertyValueSingle('Scene.NightSkyVenus.Renderable.Fade', 0.0, 1.0);
    openspace.setPropertyValueSingle('Scene.NightSkyMars.Renderable.Fade', 0.0, 1.0);
    openspace.setPropertyValueSingle('Scene.NightSkyJupiter.Renderable.Fade', 0.0, 1.0);
    openspace.setPropertyValueSingle('Scene.NightSkySaturn.Renderable.Fade', 0.0, 1.0);
  ]],
  Documentation = "Hides night sky versions of the planets",
  GuiPath = "/Night Sky/Planets",
  IsLocal = false
}


asset.onInitialize(function()
  openspace.addSceneGraphNode(Mercury)
  openspace.addSceneGraphNode(Venus)
  openspace.addSceneGraphNode(Mars)
  openspace.addSceneGraphNode(Jupiter)
  openspace.addSceneGraphNode(Saturn)
  openspace.action.registerAction(showAction)
  openspace.action.registerAction(hideAction)
end)

asset.onDeinitialize(function()
  openspace.action.removeAction(hideAction)
  openspace.action.removeAction(showAction)
  openspace.removeSceneGraphNode(Saturn)
  openspace.removeSceneGraphNode(Jupiter)
  openspace.removeSceneGraphNode(Mars)
  openspace.removeSceneGraphNode(Venus)
  openspace.removeSceneGraphNode(Mercury)
end)
