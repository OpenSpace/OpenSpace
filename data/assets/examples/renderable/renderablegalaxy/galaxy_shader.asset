-- With Custom Shader
-- This example creates a rendering of the volumetric milky way galaxy, but using a custom
-- shader to highlight the arms of the galaxy.

local data = asset.resource({
  Name = "Milkyway Volume Data",
  Type = "HttpSynchronization",
  Identifier = "milkyway_volume_data",
  Version = 1
})


local KiloParsec = 3.086E19

local Node = {
  Identifier = "RenderableGalaxy_Example_CustomShader",
  Transform = {
    Translation = {
      Type = "StaticTranslation",
      -- The center of the Milky Way is approximately 8 kiloparsec from the Sun.
      -- The x-axis of galactic coordinates points from the Sun towards the galaxy center
      Position = { 8 * KiloParsec, 0, 0 }
    }
  },
  Renderable = {
    Type = "RenderableGalaxy",
    StepSize = 0.01,
    AbsorptionMultiply = 200,
    EmissionMultiply = 250,
    Rotation = { math.pi, 3.1248, 4.45741 },
    RaycastingShader = asset.resource("galaxyraycast.glsl"),
    Volume = {
      Type = "Volume",
      Filename = data .. "MilkyWayRGBAVolume1024x1024x128.raw",
      Dimensions = { 1024, 1024, 128 },
      Size = { 1.2E21, 1.2E21, 0.15E21 },
      Downscale = 0.4
    },
    Points = {
      Type = "Points",
      Filename = data .. "MilkyWayPoints.off",
      EnabledPointsRatio = 0.3,
      Texture = data .. "halo.png"
    }
  },
  GUI = {
    Name = "RenderableGalaxy - Custom Shader",
    Path = "/Examples"
  }
}

asset.onInitialize(function()
  openspace.addSceneGraphNode(Node)
end)

asset.onDeinitialize(function()
  openspace.removeSceneGraphNode(Node)
end)
