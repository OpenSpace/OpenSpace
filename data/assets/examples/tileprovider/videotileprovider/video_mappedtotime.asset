-- Mapped to Time
-- Adds a video as a layer on a globe (Earth) where the video playback is mapped to the
-- simulation time. In this case, the video will play from 20:00 to 21:00 on January 29,
-- 2023 in the simulation.

local earth = asset.require("scene/solarsystem/planets/earth/earth")

-- The video file is here downloaded from a URL. This code returns the path to a folder
-- where the file is stored after download
local data = asset.resource({
  Name = "Example Video",
  Type = "UrlSynchronization",
  Identifier = "example_video",
  Url = "https://liu-se.cdn.openspaceproject.com/files/examples/video/chlorophyll_model_2048.mp4"
})

-- For a local file, use "asset.resource("path/to/local/video.mp4")" here instead
local video = data .. "chlorophyll_model_2048.mp4"

local Layer = {
  Name = "VideoLayer Example Mapped to Time",
  Type = "VideoTileProvider",
  Identifier = "VideoLayer_Example_MappedToTime",
  Enabled = true,
  Video = video,
  StartTime = "2023 01 29 20:00:00",
  EndTime = "2023 01 29 21:00:00",
  PlaybackMode = "MapToSimulationTime",
  Description = [[
    Video mapped to the simulation time in OpenSpace. The video will play from 20:00 to
    21:00 on January 29, 2023.
  ]]
}

asset.onInitialize(function()
  openspace.globebrowsing.addLayer(earth.Earth.Identifier, "ColorLayers", Layer)
end)

asset.onDeinitialize(function()
  openspace.globebrowsing.deleteLayer(earth.Earth.Identifier, "ColorLayers", Layer)
end)
