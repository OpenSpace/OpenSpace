-- local sunTransforms = asset.require("scene/solarsystem/sun/transforms")
local choury = asset.require("scene/solarsystem/missions/rosetta/67p.asset")
local transforms = asset.require("scene/solarsystem/planets/earth/transforms")
local earth = asset.require("scene/solarsystem/planets/earth/earth")

local moleculeDb = "https://home.thissma.fr/moldata/"

local moleculeFiles = asset.syncedResource({
  Name = "Molecule Files",
  Type = "UrlSynchronization",
  Identifier = "molecule_files",
  Url = {
    moleculeDb .. "67P-molecules/acetaldehyde.arc",
    moleculeDb .. "67P-molecules/acetic-acid.arc",
    moleculeDb .. "67P-molecules/butanal.arc",
    moleculeDb .. "67P-molecules/co2.arc",
    moleculeDb .. "67P-molecules/eg.arc",
    moleculeDb .. "67P-molecules/ethanol.arc",
    moleculeDb .. "67P-molecules/formaldehyde.arc",
    moleculeDb .. "67P-molecules/formic.arc",
    moleculeDb .. "67P-molecules/h2o.arc",
    moleculeDb .. "67P-molecules/methanol.arc",
    moleculeDb .. "67P-molecules/methyl-acetate.arc",
    moleculeDb .. "67P-molecules/n2.arc",
    moleculeDb .. "67P-molecules/o2.arc",
    moleculeDb .. "67P-molecules/propanal.arc",

    moleculeDb .. "aspirin/aspirin.gro",
    moleculeDb .. "aspirin/aspirin.xtc",
    moleculeDb .. "ice-melting/ice.gro",
    moleculeDb .. "ice-melting/ice.xtc",
    moleculeDb .. "c60.arc",
  }
})

local MoleculeSimulation = {
  Identifier = "MoleculeSimulation",
  -- Parent = sunTransforms.SolarSystemBarycenter.Identifier,
  Parent = choury.Barycenter.Identifier,
  Transform = {
    Translation = {
      Type = "StaticTranslation",
      Position = { 5E3, 0, 0 }, -- some distance away from the comet
    }
  },
  Renderable = {
    Type = "RenderableSimulationBox",
    MoleculeFiles = { moleculeFiles .. "ice.gro" },
    TrajectoryFiles = { moleculeFiles .. "ice.xtc" },
    MoleculeCounts = { 1 },
    LinearVelocity = 10.0,
    AngularVelocity = 60.0 / 360.0 * 3.14,
    SimulationBox = { 200.0, 200.0, 200.0 },
    CollisionRadius = 2.0,
    SimulationSpeed = 0,
    AnimationSpeed = 1,
  },
  GUI = {
    Path = "/Microcosmos/Molecules/Simulation"
  }
}

asset.onInitialize(function()
  openspace.addSceneGraphNode(MoleculeSimulation)
end)
    
asset.onDeinitialize(function()
  openspace.removeSceneGraphNode(MoleculeSimulation)
end)
    
asset.export(MoleculeSimulation)

-- Troposphere

local molPerVolume = 2700 -- there are roughly 2700 molecules per 100*100*100 ångström volume at atmospheric pressure.

local EarthMolecules1 = {
  Identifier = "EarthMolecules1",
  Parent = transforms.EarthIAU.Identifier,
  Transform = {
    Translation = {
      Type = "GlobeTranslation",
      Globe = earth.Earth.Identifier,
      Latitude = 58.5877, -- above the vis-C center
      Longitude = 16.1924,
      Altitude = 10E3, -- 10 km = in the troposphere
      UseHeightmap = true,
    },
  },
  Renderable = {
    Type = "RenderableSimulationBox",
    MoleculeFiles = { moleculeFiles .. "n2.arc", moleculeFiles .. "o2.arc", moleculeFiles .. "h2o.arc" },
    TrajectoryFiles = { moleculeFiles .. "n2.arc", moleculeFiles .. "o2.arc", moleculeFiles .. "h2o.arc" },
    MoleculeCounts = { 0.78 * molPerVolume, 0.21 * molPerVolume, 0.03 * molPerVolume },
    LinearVelocity = 10.0,
    AngularVelocity = 60.0 / 360.0 * 3.14,
    SimulationBox = { 100.0, 100.0, 100.0 },
    CollisionRadius = 2.0,
    AnimationSpeed = 100,
    SSAOEnabled = true,
  },
  GUI = {
    Path = "/Microcosmos/Molecules/EarthMolecules1"
  }
}

asset.onInitialize(function()
  openspace.addSceneGraphNode(EarthMolecules1)
end)

asset.onDeinitialize(function()
  openspace.removeSceneGraphNode(EarthMolecules1)
end)

asset.export(EarthMolecules1)

-- local molPerVolume = 2700 -- there are roughly 2700 molecules per 100*100*100 ångström volume at atmospheric pressure.

-- local EarthMolecules1 = {
--   Identifier = "EarthMolecules1",
--   Parent = transforms.EarthIAU.Identifier,
--   Transform = {
--     Translation = {
--       Type = "StaticTranslation",
--       Position = { 6400E3, 0, 0 },
--     }
--   },
--   Renderable = {
--     Type = "RenderableSimulationBox",
--     MoleculeFiles = { moleculeFiles .. "n2.arc", moleculeFiles .. "o2.arc", moleculeFiles .. "h2o.arc" },
--     TrajectoryFiles = { moleculeFiles .. "n2.arc", moleculeFiles .. "o2.arc", moleculeFiles .. "h2o.arc" },
--     MoleculeCounts = { 0.78 * molPerVolume, 0.21 * molPerVolume, 0.03 * molPerVolume },
--     LinearVelocity = 10.0,
--     AngularVelocity = 60.0 / 360.0 * 3.14,
--     SimulationBox = { 100.0, 100.0, 100.0 },
--     CollisionRadius = 2.0,
--     AnimationSpeed = 100,
--     SSAOEnabled = true,
--   },
--   GUI = {
--     Path = "/Microcosmos/Molecules/EarthMolecules1"
--   }
-- }

-- asset.onInitialize(function()
--   openspace.addSceneGraphNode(EarthMolecules1)
-- end)

-- asset.onDeinitialize(function()
--   openspace.removeSceneGraphNode(EarthMolecules1)
-- end)

-- asset.export(EarthMolecules1)
