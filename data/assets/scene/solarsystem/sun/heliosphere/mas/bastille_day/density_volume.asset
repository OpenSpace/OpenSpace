local assetHelper = asset.require("util/asset_helper")
local sunTransforms = asset.require('scene/solarsystem/sun/transforms')
local transforms = asset.require('./transforms')

local densityDirectory = asset.syncedResource({
    Name = "Bastille Day MAS Density",
    Type = "HttpSynchronization",
    Identifier = "bastille_day_mas_density",
    Version = 1
})

--local mirrorVolumeMatrix = {
    --1.0, 0.0, 0.0,
    --0.0, 1.0, 0.0,
    --0.0, 0.0, 1.0


--    -1.0, 0.0, 0.0,
--    0.0, 1.0, 0.0,
--    0.0, 0.0, -1.0
    
    --0.0, 1.0, 0.0,
    --1.0, 0.0, 0.0,
    --0.0, 0.0, 1.0
--}

local sunRadius = 6.957E8

local densityVolume = {
    Identifier = "MAS_MHD_density",
    -- wrong     Parent = sunTransforms.SolarSystemBarycenter.Identifier,
    -- right 
    Parent = sunTransforms.SunIAU.Identifier,
    -- wrong Parent = transforms.HNMReferenceFrame.Identifier,
    Renderable = {
        Type = "RenderableTimeVaryingVolume",
        StepSize = 0.004,
        --Enabled = false,
        Opacity = 0.3,
        TransferFunction = asset.localResource("transferfunctions/mas_mhd_r_squared.txt"), --test1
        SourceDirectory = densityDirectory,
        --LowerValueBound = 0,
        --UpperValueBound = 1,
        GridType = "Spherical",
        SecondsBefore = 24*60*60,
        SecondsAfter = 24*60*60,
        Dimensions = {100, 100, 128},
        InvertDataAtZ = true
    },
    Transform = {
        Scale = {
            Type = "StaticScale",
            Scale = sunRadius
        },
        Rotation = {
            --Type = "StaticRotation", --LuaRotation
            --Rotation = mirrorVolumeMatrix
            Type = "FixedRotation",
                XAxis = {-1.0, 0.0, 0.0},
                YAxis = {0.0, 1.0, 0.0},
                ZAxis = {0.0, 0.0, -1.0}

            --XAxis = {1.0, 0.0, 0.0},
            --YAxis = {0.0, 1.0, 0.0},
            --ZAxis = {0.0, 0.0, -1.0}

            --XAxis = {1.0, 0.0, 0.0},
            --YAxis = {0.0, 1.0, 0.0},
            --ZAxis = {0.0, 0.0, -1.0}

            --Script = asset.localResource("kernels/carringtonRotation.lua")
        }       
    },
    GUI = {
        Name = "MAS Density",
        Path = "/Solar System/Heliosphere"
    }
}

assetHelper.registerSceneGraphNodesAndExport(asset, { densityVolume })

asset.meta = {
    Name = "Predictive Science Inc. Volume Rendering Bastille Day",
    Version = "1.0",
    Description = " Volumetric rendering for the bastille day CME event ",
    Author = "OpenSpace team",
    URL = "https://dx.doi.org/10.3847/1538-4357/aab36d",
    License = ""
}
