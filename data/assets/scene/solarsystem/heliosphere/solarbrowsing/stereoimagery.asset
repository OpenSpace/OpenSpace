asset.require('scene/solarsystem/missions/stereo/stereo_a')
local coreKernels = asset.require("spice/core")
local kernels = asset.require("scene/solarsystem/missions/stereo/kernels")
local sunTransforms = asset.require("scene/solarsystem/sun/transforms")



-- We use the Stereo position with an added rotation to stabilize the image and remove
-- any wobble effect since we don't have the ck kernels.
local StereoPosition = {
  Identifier = "StereoA_Position_Ecliptic",
  Parent = sunTransforms.SolarSystemBarycenter.Identifier,
  Transform = {
    Translation = {
      Type = "SpiceTranslation",
      Target = kernels.ID.STEREO_A,
      Observer = coreKernels.ID.SolarSystemBarycenter,
    },
    -- This rotation removes tiny wobbles and fixes the frame in place.
    Rotation = {
      Type = "SpiceRotation",
      SourceFrame = coreKernels.Frame.EclipJ2000,
      DestinationFrame = coreKernels.Frame.Galactic
    }
  },
  GUI = {
    Name = "STEREO_A Position",
    Path = "/Solar System/Missions/STEREO_A",
    Hidden = true,
    Focusable = false
  }
}

local SolarImagery = {
  Identifier = "SolarImagery_STEREO-A_EUV",
  Parent = StereoPosition.Identifier,
  Renderable = {
    Type = "RenderableSolarImagery",
    ImageDirectory = openspace.absPath("${SYNC_DYNAMIC}/solarbrowsing/stereo"),
    TransferfunctionDir = asset.resource("colortables")
  },
  GUI = {
    Name = "STEREO_A EUV-I-A Imagery",
    Path = "/Solar System/Solar Imagery"
  }
}


asset.onInitialize(function ()
  openspace.addSceneGraphNode(StereoPosition)
  openspace.addSceneGraphNode(SolarImagery)
end
)

asset.onDeinitialize(function ()
  openspace.removeSceneGraphNode(SolarImagery)
  openspace.removeSceneGraphNode(StereoPosition)
end
)

asset.export("Imagery", SolarImagery)



asset.meta = {
  Name = "STEREO Solar Imagery",
  Description = [[The STEREO spacecraft imagery, showing images of the Sun in different
    wavelengths.]],
  Author = "OpenSpace Team",
  URL = "http://openspaceproject.com",
  License = "MIT license"
}
