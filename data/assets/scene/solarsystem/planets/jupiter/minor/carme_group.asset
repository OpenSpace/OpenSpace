local proceduralGlobes = asset.require("util/procedural_globe")
local transforms = asset.require("../transforms")
local kernel = asset.require("../kernels").jup344
local kernel346 = asset.require("../kernels").jup346



local parentIdentifier = transforms.JupiterBarycenter.Identifier
local parentSpice = "JUPITER BARYCENTER"
local tags = { "moon_solarSystem", "moon_giants", "moon_jupiter", "moon_carme", "moon_minor", "moon_minor_jupiter" }
local trailColor = { 0.4, 0.3, 0.01 }
local trailTags = {
  "moonTrail_solarSystem",
  "moonTrail_giants",
  "moonTrail_jupiter",
  "moonTrail_minor",
  "moonTrail_minor_jupiter"
}

local carmeGroup = {
  {
    Identifier = "Herse",
    Parent = {
      Identifier = parentIdentifier,
      Spice = parentSpice
    },
    Spice = "HERSE",
    Radii = { 2000, 2000, 2000 },
    Tags = tags,
    TrailTags = trailTags,
    GUI = {
      Path = "/Solar System/Planets/Jupiter/Minor Moons/Carme Group/Herse"
    },
    TrailColor = trailColor,
    OrbitPeriod = 672.75,
    Kernels = kernel
  },
  {
    Identifier = "Aitne",
    Parent = {
      Identifier = parentIdentifier,
      Spice = parentSpice
    },
    Spice = "AITNE",
    Radii = { 3000, 3000, 3000 },
    Tags = tags,
    TrailTags = trailTags,
    GUI = {
      Path = "/Solar System/Planets/Jupiter/Minor Moons/Carme Group/Aitne"
    },
    TrailColor = trailColor,
    OrbitPeriod = 679.64,
    Kernels = kernel
  },
  {
    Identifier = "Kale",
    Parent = {
      Identifier = parentIdentifier,
      Spice = parentSpice
    },
    Spice = "KALE",
    Radii = { 2000, 2000, 2000 },
    Tags = tags,
    TrailTags = trailTags,
    GUI = {
      Path = "/Solar System/Planets/Jupiter/Minor Moons/Carme Group/Kale"
    },
    TrailColor = trailColor,
    OrbitPeriod = 685.32,
    Kernels = kernel
  },
  {
    Identifier = "Taygete",
    Parent = {
      Identifier = parentIdentifier,
      Spice = parentSpice
    },
    Spice = "TAYGETE",
    Radii = { 5000, 5000, 5000 },
    Tags = tags,
    TrailTags = trailTags,
    GUI = {
      Path = "/Solar System/Planets/Jupiter/Minor Moons/Carme Group/Taygete"
    },
    TrailColor = trailColor,
    OrbitPeriod = 686.67,
    Kernels = kernel
  },
  {
    Identifier = "Chaldene",
    Parent = {
      Identifier = parentIdentifier,
      Spice = parentSpice
    },
    Spice = "CHALDENE",
    Radii = { 4000, 4000, 4000 },
    Tags = tags,
    TrailTags = trailTags,
    GUI = {
      Path = "/Solar System/Planets/Jupiter/Minor Moons/Carme Group/Chaldene"
    },
    TrailColor = trailColor,
    OrbitPeriod = 699.33,
    Kernels = kernel
  },
  {
    Identifier = "Erinome",
    Parent = {
      Identifier = parentIdentifier,
      Spice = parentSpice
    },
    Spice = "ERINOME",
    Radii = { 3000, 3000, 3000 },
    Tags = tags,
    TrailTags = trailTags,
    GUI = {
      Path = "/Solar System/Planets/Jupiter/Minor Moons/Carme Group/Erinome"
    },
    TrailColor = trailColor,
    OrbitPeriod = 711.96,
    Kernels = kernel
  },
  {
    Identifier = "Kallichore",
    Parent = {
      Identifier = parentIdentifier,
      Spice = parentSpice
    },
    Spice = "KALLICHORE",
    Radii = { 2000, 2000, 2000 },
    Tags = tags,
    TrailTags = trailTags,
    GUI = {
      Path = "/Solar System/Planets/Jupiter/Minor Moons/Carme Group/Kallichore"
    },
    TrailColor = trailColor,
    OrbitPeriod = 717.81,
    Kernels = kernel
  },
  {
    Identifier = "Kalyke",
    Parent = {
      Identifier = parentIdentifier,
      Spice = parentSpice
    },
    Spice = "KALYKE",
    Radii = { 5000, 5000, 5000 },
    Tags = tags,
    TrailTags = trailTags,
    GUI = {
      Path = "/Solar System/Planets/Jupiter/Minor Moons/Carme Group/Kalyke"
    },
    TrailColor = trailColor,
    OrbitPeriod = 721.02,
    Kernels = kernel
  },
  {
    Identifier = "Pasithee",
    Parent = {
      Identifier = parentIdentifier,
      Spice = parentSpice
    },
    Spice = "PASITHEE",
    Radii = { 2000, 2000, 2000 },
    Tags = tags,
    TrailTags = trailTags,
    GUI = {
      Path = "/Solar System/Planets/Jupiter/Minor Moons/Carme Group/Pasithee"
    },
    TrailColor = trailColor,
    OrbitPeriod = 726.93,
    Kernels = kernel
  },
  {
    Identifier = "S2010J1",
    Parent = {
      Identifier = parentIdentifier,
      Spice = parentSpice
    },
    Spice = "551",
    Radii = { 2000, 2000, 2000 },
    Tags = tags,
    TrailTags = trailTags,
    GUI = {
      Name = "S/2010 J 1",
      Path = "/Solar System/Planets/Jupiter/Minor Moons/Carme Group/S2010J1"
    },
    TrailColor = trailColor,
    OrbitPeriod = 722.83,
    Kernels = kernel
  },
  {
    Identifier = "Eukelade",
    Parent = {
      Identifier = parentIdentifier,
      Spice = parentSpice
    },
    Spice = "EUKELADE",
    Radii = { 4000, 4000, 4000 },
    Tags = tags,
    TrailTags = trailTags,
    GUI = {
      Path = "/Solar System/Planets/Jupiter/Minor Moons/Carme Group/Eukelade"
    },
    TrailColor = trailColor,
    OrbitPeriod = 735.20,
    Kernels = kernel
  },
  {
    Identifier = "Arche",
    Parent = {
      Identifier = parentIdentifier,
      Spice = parentSpice
    },
    Spice = "ARCHE",
    Radii = { 3000, 3000, 3000 },
    Tags = tags,
    TrailTags = trailTags,
    GUI = {
      Path = "/Solar System/Planets/Jupiter/Minor Moons/Carme Group/Arche"
    },
    TrailColor = trailColor,
    OrbitPeriod = 746.19,
    Kernels = kernel
  },
  {
    Identifier = "Isonoe",
    Parent = {
      Identifier = parentIdentifier,
      Spice = parentSpice
    },
    Spice = "ISONOE",
    Radii = { 4000, 4000, 4000 },
    Tags = tags,
    TrailTags = trailTags,
    GUI = {
      Path = "/Solar System/Planets/Jupiter/Minor Moons/Carme Group/Isonoe"
    },
    TrailColor = trailColor,
    OrbitPeriod = 750.13,
    Kernels = kernel
  },
  {
    Identifier = "Carme",
    Parent = {
      Identifier = parentIdentifier,
      Spice = parentSpice
    },
    Spice = "CARME",
    Radii = { 46000, 46000, 46000 },
    Tags = tags,
    TrailTags = trailTags,
    GUI = {
      Path = "/Solar System/Planets/Jupiter/Minor Moons/Carme Group/Carme"
    },
    TrailColor = trailColor,
    OrbitPeriod = 763.95,
    Kernels = kernel
  },
  {
    Identifier = "S2003J5",
    Parent = {
      Identifier = parentIdentifier,
      Spice = parentSpice
    },
    Spice = "557",
    Radii = { 4000, 4000, 4000 },
    Tags = tags,
    TrailTags = trailTags,
    GUI = {
      Name = "S/2003 J 5",
      Path = "/Solar System/Planets/Jupiter/Minor Moons/Carme Group/S2003J5"
    },
    TrailColor = trailColor,
    OrbitPeriod = 758.34,
    Kernels = kernel
  },
  {
    Identifier = "S2018J3",
    Parent = {
      Identifier = parentIdentifier,
      Spice = parentSpice
    },
    Spice = "55511",
    Radii = { 1000, 1000, 1000 },
    Tags = tags,
    TrailTags = trailTags,
    GUI = {
      Name = "S/2018 J 3",
      Path = "/Solar System/Planets/Jupiter/Minor Moons/Carme Group/S2018J3"
    },
    TrailColor = trailColor,
    OrbitPeriod = 704.56,
    Kernels = kernel346
  },
  {
    Identifier = "S2021J4",
    Parent = {
      Identifier = parentIdentifier,
      Spice = parentSpice
    },
    Spice = "55515",
    Radii = { 1000, 1000, 1000 },
    Tags = tags,
    TrailTags = trailTags,
    GUI = {
      Name = "S/2021 J 4",
      Path = "/Solar System/Planets/Jupiter/Minor Moons/Carme Group/S2021J4"
    },
    TrailColor = trailColor,
    OrbitPeriod = 710.13,
    Kernels = kernel346
  },
  {
    Identifier = "S2021J5",
    Parent = {
      Identifier = parentIdentifier,
      Spice = parentSpice
    },
    Spice = "55516",
    Radii = { 2000, 2000, 2000 },
    Tags = tags,
    TrailTags = trailTags,
    GUI = {
      Name = "S/2021 J 5",
      Path = "/Solar System/Planets/Jupiter/Minor Moons/Carme Group/S2021J5"
    },
    TrailColor = trailColor,
    OrbitPeriod = 704.80,
    Kernels = kernel346
  },
  {
    Identifier = "S2021J6",
    Parent = {
      Identifier = parentIdentifier,
      Spice = parentSpice
    },
    Spice = "55517",
    Radii = { 1000, 1000, 1000 },
    Tags = tags,
    TrailTags = trailTags,
    GUI = {
      Name = "S/2021 J 6",
      Path = "/Solar System/Planets/Jupiter/Minor Moons/Carme Group/S2021J6"
    },
    TrailColor = trailColor,
    OrbitPeriod = 732.55,
    Kernels = kernel346
  },
  {
    Identifier = "S2016J3",
    Parent = {
      Identifier = parentIdentifier,
      Spice = parentSpice
    },
    Spice = "55518",
    Radii = { 2000, 2000, 2000 },
    Tags = tags,
    TrailTags = trailTags,
    GUI = {
      Name = "S/2016 J 3",
      Path = "/Solar System/Planets/Jupiter/Minor Moons/Carme Group/S2016J3"
    },
    TrailColor = trailColor,
    OrbitPeriod = 676.37,
    Kernels = kernel346
  },
  {
    Identifier = "S2022J1",
    Parent = {
      Identifier = parentIdentifier,
      Spice = parentSpice
    },
    Spice = "55521",
    Radii = { 2000, 2000, 2000 },
    Tags = tags,
    TrailTags = trailTags,
    GUI = {
      Name = "S/2022 J 1",
      Path = "/Solar System/Planets/Jupiter/Minor Moons/Carme Group/S2022J1"
    },
    TrailColor = trailColor,
    OrbitPeriod = 667.34,
    Kernels = kernel346
  },
  {
    Identifier = "S2022J2",
    Parent = {
      Identifier = parentIdentifier,
      Spice = parentSpice
    },
    Spice = "55522",
    Radii = { 1000, 1000, 1000 },
    Tags = tags,
    TrailTags = trailTags,
    GUI = {
      Name = "S/2022 J 2",
      Path = "/Solar System/Planets/Jupiter/Minor Moons/Carme Group/S2022J2"
    },
    TrailColor = trailColor,
    OrbitPeriod = 685.51,
    Kernels = kernel346
  },
  {
    Identifier = "S2017J2",
    Parent = {
      Identifier = parentIdentifier,
      Spice = parentSpice
    },
    Spice = "563",
    Radii = { 1000, 1000, 1000 },
    Tags = tags,
    TrailTags = trailTags,
    GUI = {
      Name = "S/2017 J 2",
      Path = "/Solar System/Planets/Jupiter/Minor Moons/Carme Group/S2017J2"
    },
    TrailColor = trailColor,
    OrbitPeriod = 723.1,
    Kernels = kernel346
  },
  {
    Identifier = "S2017J5",
    Parent = {
      Identifier = parentIdentifier,
      Spice = parentSpice
    },
    Spice = "566",
    Radii = { 2000, 2000, 2000 },
    Tags = tags,
    TrailTags = trailTags,
    GUI = {
      Name = "S/2017 J 5",
      Path = "/Solar System/Planets/Jupiter/Minor Moons/Carme Group/S2017J5"
    },
    TrailColor = trailColor,
    OrbitPeriod = 719.5,
    Kernels = kernel
  },
  {
    Identifier = "S2017J8",
    Parent = {
      Identifier = parentIdentifier,
      Spice = parentSpice
    },
    Spice = "569",
    Radii = { 1000, 1000, 1000 },
    Tags = tags,
    TrailTags = trailTags,
    GUI = {
      Name = "S/2017 J 8",
      Path = "/Solar System/Planets/Jupiter/Minor Moons/Carme Group/S2017J8"
    },
    TrailColor = trailColor,
    OrbitPeriod = 719.6,
    Kernels = kernel
  },
  {
    Identifier = "S2011J1",
    Parent = {
      Identifier = parentIdentifier,
      Spice = parentSpice
    },
    Spice = "572",
    Radii = { 2000, 2000, 2000 },
    Tags = tags,
    TrailTags = trailTags,
    GUI = {
      Name = "S/2011 J 1",
      Path = "/Solar System/Planets/Jupiter/Minor Moons/Carme Group/S2011J1"
    },
    TrailColor = trailColor,
    OrbitPeriod = 686.6,
    Kernels = kernel
  },
  {
    Identifier = "S2003J9",
    Parent = {
      Identifier = parentIdentifier,
      Spice = parentSpice
    },
    Spice = "55503",
    Radii = { 1000, 1000, 1000 },
    Tags = tags,
    TrailTags = trailTags,
    GUI = {
      Name = "S/2003 J 9",
      Path = "/Solar System/Planets/Jupiter/Minor Moons/Carme Group/S2003J9"
    },
    TrailColor = trailColor,
    OrbitPeriod = 767.6,
    Kernels = kernel
  },
  {
    Identifier = "S2003J10",
    Parent = {
      Identifier = parentIdentifier,
      Spice = parentSpice
    },
    Spice = "55504",
    Radii = { 2000, 2000, 2000 },
    Tags = tags,
    TrailTags = trailTags,
    GUI = {
      Name = "S/2003 J 10",
      Path = "/Solar System/Planets/Jupiter/Minor Moons/Carme Group/S2003J10"
    },
    TrailColor = trailColor,
    OrbitPeriod = 705.96,
    Kernels = kernel
  }
}


-- Generate labels for each moon
local moon_labels = {}

for i, moon in ipairs(carmeGroup) do
  local moonName = moon.GUI.Name or moon.Identifier
  moon_labels[i] = {
    Identifier = moon.Identifier .. "Label",
    Parent = moon.Identifier,
    Renderable = {
      Enabled = false,
      Type = "RenderableLabel",
      Text = moonName,
      FontSize = 70.0,
      Size = 7.1,
      MinMaxSize = { 1, 25 },
      OrientationOption = "Camera View Direction",
      BlendMode = "Additive",
      EnableFading = true,
      FadeUnit = "Gm",
      FadeDistances = { 2.0, 125.0 },
      FadeWidths = { 0.5, 50.0 }
    },
    Tag = { "solarsystem_labels", "moon_labels", "minor_moon_labels" },
    GUI = {
      Name = moonName .. " Label",
      Path = "/Solar System/Planets/Jupiter/Minor Moons/Carme Group/" .. moon.Identifier,
      Description = "Label for Jupiter's moon " .. moonName .. " (Carme group)"
    }
  }
end



local nodes = proceduralGlobes.createGlobes(carmeGroup)

asset.onInitialize(function()
  for _, node in ipairs(nodes) do
    openspace.addSceneGraphNode(node)
  end

  for _, moonlabel in ipairs(moon_labels) do
    openspace.addSceneGraphNode(moonlabel)
  end
end)

asset.onDeinitialize(function()
  for i = #moon_labels, 1, -1 do
    openspace.removeSceneGraphNode(moon_labels[i])
  end

  for i = #nodes, 1, -1 do
    openspace.removeSceneGraphNode(nodes[i])
  end
end)

for _, node in ipairs(nodes) do
  asset.export(node)
end


asset.meta = {
  Name = "Jupiter Carme Group Moons",
  Version = "1.0",
  Description = [[Procedural Globe asset containing Jupiter's Carme Group moons: Herse,
    Aitne, Kale, Taygete, Chaldene, Erinome, Kallichore, Kalyke, Pasithee, S2010J1,
    Eukelade, Arche, Isonoe, Carme, and S2003J5. Blank globes and SPICE trails are
    generated for each moon]],
  Author = "OpenSpace Team",
  URL = "http://openspaceproject.com",
  License = "MIT license"
}
