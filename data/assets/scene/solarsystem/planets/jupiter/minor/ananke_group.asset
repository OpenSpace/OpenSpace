local proceduralGlobes = asset.require("util/procedural_globe")
local transforms = asset.require("../transforms")
local kernel = asset.require("../kernels").jup344
local kernel346 = asset.require("../kernels").jup346



local parentIdentifier = transforms.JupiterBarycenter.Identifier
local parentSpice = "JUPITER BARYCENTER"
local tags = { "moon_solarSystem", "moon_giants", "moon_jupiter", "moon_ananke", "moon_minor", "moon_minor_jupiter" }
local trailColor = { 0.4, 0.3, 0.01 }
local trailTags = {
  "moonTrail_solarSystem",
  "moonTrail_giants",
  "moonTrail_jupiter",
  "moonTrail_minor",
  "moonTrail_minor_jupiter"
}

local anankeGroup = {
  {
    Identifier = "S2010J2",
    Parent = {
      Identifier = parentIdentifier,
      Spice = parentSpice
    },
    Spice = "552",
    Radii = { 1000, 1000, 1000 },
    Tags = tags,
    TrailTags = trailTags,
    GUI = {
      Name = "S/2010 J 2",
      Path = "/Solar System/Planets/Jupiter/Minor Moons/Ananke Group/S2010J2"
    },
    TrailColor = trailColor,
    OrbitPeriod = 588.36,
    Kernels = kernel
  },
  {
    Identifier = "Thelxinoe",
    Parent = {
      Identifier = parentIdentifier,
      Spice = parentSpice
    },
    Spice = "THELXINOE",
    Radii = { 2000, 2000, 2000 },
    Tags = tags,
    TrailTags = trailTags,
    GUI = {
      Path = "/Solar System/Planets/Jupiter/Minor Moons/Ananke Group/Thelxinoe"
    },
    TrailColor = trailColor,
    OrbitPeriod = 597.61,
    Kernels = kernel
  },
  {
    Identifier = "Euanthe",
    Parent = {
      Identifier = parentIdentifier,
      Spice = parentSpice
    },
    Spice = "EUANTHE",
    Radii = { 3000, 3000, 3000 },
    Tags = tags,
    TrailTags = trailTags,
    GUI = {
      Path = "/Solar System/Planets/Jupiter/Minor Moons/Ananke Group/Euanthe"
    },
    TrailColor = trailColor,
    OrbitPeriod = 598.09,
    Kernels = kernel
  },
  {
    Identifier = "Iocaste",
    Parent = {
      Identifier = parentIdentifier,
      Spice = parentSpice
    },
    Spice = "IOCASTE",
    Radii = { 5000, 5000, 5000 },
    Tags = tags,
    TrailTags = trailTags,
    GUI = {
      Path = "/Solar System/Planets/Jupiter/Minor Moons/Ananke Group/Iocaste"
    },
    TrailColor = trailColor,
    OrbitPeriod = 609.43,
    Kernels = kernel
  },
  {
    Identifier = "S2003J16",
    Parent = {
      Identifier = parentIdentifier,
      Spice = parentSpice
    },
    Spice = "55506",
    Radii = { 2000, 2000, 2000 },
    Tags = tags,
    TrailTags = trailTags,
    GUI = {
      Name = "S/2003 J 16",
      Path = "/Solar System/Planets/Jupiter/Minor Moons/Ananke Group/S2003J16"
    },
    TrailColor = trailColor,
    OrbitPeriod = 610.36,
    Kernels = kernel
  },
  {
    Identifier = "Praxidike",
    Parent = {
      Identifier = parentIdentifier,
      Spice = parentSpice
    },
    Spice = "PRAXIDIKE",
    Radii = { 7000, 7000, 7000 },
    Tags = tags,
    TrailTags = trailTags,
    GUI = {
      Path = "/Solar System/Planets/Jupiter/Minor Moons/Ananke Group/Praxidike"
    },
    TrailColor = trailColor,
    OrbitPeriod = 613.90,
    Kernels = kernel
  },
  {
    Identifier = "Harpalyke",
    Parent = {
      Identifier = parentIdentifier,
      Spice = parentSpice
    },
    Spice = "HARPALYKE",
    Radii = { 4000, 4000, 4000 },
    Tags = tags,
    TrailTags = trailTags,
    GUI = {
      Path = "/Solar System/Planets/Jupiter/Minor Moons/Ananke Group/Harpalyke"
    },
    TrailColor = trailColor,
    OrbitPeriod = 624.54,
    Kernels = kernel
  },
  {
    Identifier = "Mneme",
    Parent = {
      Identifier = parentIdentifier,
      Spice = parentSpice
    },
    Spice = "MNEME",
    Radii = { 2000, 2000, 2000 },
    Tags = tags,
    TrailTags = trailTags,
    GUI = {
      Path = "/Solar System/Planets/Jupiter/Minor Moons/Ananke Group/Mneme"
    },
    TrailColor = trailColor,
    OrbitPeriod = 627.48,
    Kernels = kernel
  },
  {
    Identifier = "Hermippe",
    Parent = {
      Identifier = parentIdentifier,
      Spice = parentSpice
    },
    Spice = "HERMIPPE",
    Radii = { 4000, 4000, 4000 },
    Tags = tags,
    TrailTags = trailTags,
    GUI = {
      Path = "/Solar System/Planets/Jupiter/Minor Moons/Ananke Group/Hermippe"
    },
    TrailColor = trailColor,
    OrbitPeriod = 629.81,
    Kernels = kernel
  },
  {
    Identifier = "Thyone",
    Parent = {
      Identifier = parentIdentifier,
      Spice = parentSpice
    },
    Spice = "THYONE",
    Radii = { 4000, 4000, 4000 },
    Tags = tags,
    TrailTags = trailTags,
    GUI = {
      Path = "/Solar System/Planets/Jupiter/Minor Moons/Ananke Group/Thyone"
    },
    TrailColor = trailColor,
    OrbitPeriod = 639.80,
    Kernels = kernel
  },
  {
    Identifier = "Ananke",
    Parent = {
      Identifier = parentIdentifier,
      Spice = parentSpice
    },
    Spice = "ANANKE",
    Radii = { 28000, 28000, 28000 },
    TrailTags = trailTags,
    Tags = tags,
    GUI = {
      Path = "/Solar System/Planets/Jupiter/Minor Moons/Ananke Group/Ananke"
    },
    TrailColor = trailColor,
    OrbitPeriod = 640.38,
    Kernels = kernel
  },
  {
    Identifier = "S2021J1",
    Parent = {
      Identifier = parentIdentifier,
      Spice = parentSpice
    },
    Spice = "55512",
    Radii = { 1000, 1000, 1000 },
    Tags = tags,
    TrailTags = trailTags,
    GUI = {
      Name = "S/2021 J 1",
      Path = "/Solar System/Planets/Jupiter/Minor Moons/Ananke Group/S2021J1"
    },
    TrailColor = trailColor,
    OrbitPeriod = 606.99,
    Kernels = kernel346
  },
  {
    Identifier = "S2021J2",
    Parent = {
      Identifier = parentIdentifier,
      Spice = parentSpice
    },
    Spice = "55513",
    Radii = { 1000, 1000, 1000 },
    Tags = tags,
    TrailTags = trailTags,
    GUI = {
      Name = "S/2021 J 2",
      Path = "/Solar System/Planets/Jupiter/Minor Moons/Ananke Group/S2021J2"
    },
    TrailColor = trailColor,
    OrbitPeriod = 627.96,
    Kernels = kernel346
  },
  {
    Identifier = "S2021J3",
    Parent = {
      Identifier = parentIdentifier,
      Spice = parentSpice
    },
    Spice = "55514",
    Radii = { 2000, 2000, 2000 },
    Tags = tags,
    TrailTags = trailTags,
    GUI = {
      Name = "S/2021 J 3",
      Path = "/Solar System/Planets/Jupiter/Minor Moons/Ananke Group/S2021J3"
    },
    TrailColor = trailColor,
    OrbitPeriod = 643.85,
    Kernels = kernel346
  },
  {
    Identifier = "S2022J3",
    Parent = {
      Identifier = parentIdentifier,
      Spice = parentSpice
    },
    Spice = "55523",
    Radii = { 1000, 1000, 1000 },
    Tags = tags,
    TrailTags = trailTags,
    GUI = {
      Name = "S/2022 J 3",
      Path = "/Solar System/Planets/Jupiter/Minor Moons/Ananke Group/S2022J3"
    },
    TrailColor = trailColor,
    OrbitPeriod = 617.82,
    Kernels = kernel346
  },
  {
    Identifier = "S2017J3",
    Parent = {
      Identifier = parentIdentifier,
      Spice = parentSpice
    },
    Spice = "564",
    Radii = { 2000, 2000, 2000 },
    Tags = tags,
    TrailTags = trailTags,
    GUI = {
      Name = "S/2017 J 3",
      Path = "/Solar System/Planets/Jupiter/Minor Moons/Ananke Group/S2017J3"
    },
    TrailColor = trailColor,
    OrbitPeriod = 606.3,
    Kernels = kernel
  },
  {
    Identifier = "S2017J7",
    Parent = {
      Identifier = parentIdentifier,
      Spice = parentSpice
    },
    Spice = "568",
    Radii = { 2000, 2000, 2000 },
    Tags = tags,
    TrailTags = trailTags,
    GUI = {
      Name = "S/2017 J 7",
      Path = "/Solar System/Planets/Jupiter/Minor Moons/Ananke Group/S2017J7"
    },
    TrailColor = trailColor,
    OrbitPeriod = 602.6,
    Kernels = kernel
  },
  {
    Identifier = "S2017J9",
    Parent = {
      Identifier = parentIdentifier,
      Spice = parentSpice
    },
    Spice = "570",
    Radii = { 3000, 3000, 3000 },
    Tags = tags,
    TrailTags = trailTags,
    GUI = {
      Name = "S/2017 J 9",
      Path = "/Solar System/Planets/Jupiter/Minor Moons/Ananke Group/S2017J9"
    },
    TrailColor = trailColor,
    OrbitPeriod = 639.2,
    Kernels = kernel
  },
  {
    Identifier = "S2003J2",
    Parent = {
      Identifier = parentIdentifier,
      Spice = parentSpice
    },
    Spice = "55501",
    Radii = { 2000, 2000, 2000 },
    Tags = tags,
    TrailTags = trailTags,
    GUI = {
      Name = "S/2003 J 2",
      Path = "/Solar System/Planets/Jupiter/Minor Moons/Ananke Group/S2003J2"
    },
    TrailColor = trailColor,
    OrbitPeriod = 602.02,
    Kernels = kernel
  },
  {
    Identifier = "S2003J12",
    Parent = {
      Identifier = parentIdentifier,
      Spice = parentSpice
    },
    Spice = "55505",
    Radii = { 1000, 1000, 1000 },
    Tags = tags,
    TrailTags = trailTags,
    GUI = {
      Name = "S/2003 J 12",
      Path = "/Solar System/Planets/Jupiter/Minor Moons/Ananke Group/S2003J12"
    },
    TrailColor = trailColor,
    OrbitPeriod = 646.64,
    Kernels = kernel
  }
}

-- Generate all moon labels
local moon_labels = {}

for i, moon in ipairs(anankeGroup) do
  local moonName = moon.GUI.Name or moon.Identifier
  moon_labels[i] = {
    Identifier = moon.Identifier .. "Label",
    Parent = moon.Identifier,
    Renderable = {
      Enabled = false,
      Type = "RenderableLabel",
      Text = moonName,
      FontSize = 70.0,
      Size = 7.1,
      MinMaxSize = { 1, 25 },
      OrientationOption = "Camera View Direction",
      BlendMode = "Additive",
      EnableFading = true,
      FadeUnit = "Gm",
      FadeDistances = { 1.5, 90.0 },
      FadeWidths = { 0.5, 90.0 }
    },
    Tag = { "solarsystem_labels", "moon_labels", "minor_moon_labels" },
    GUI = {
      Name = moonName .. " Label",
      Path = "/Solar System/Planets/Jupiter/Minor Moons/Ananke Group/" .. moon.Identifier,
      Description = "Label for Jupiter's moon " .. moonName .. " (Ananke group)"
    }
  }
end


local nodes = proceduralGlobes.createGlobes(anankeGroup)

asset.onInitialize(function()
  for _, node in ipairs(nodes) do
    openspace.addSceneGraphNode(node)
  end

  for _, moonlabel in ipairs(moon_labels) do
    openspace.addSceneGraphNode(moonlabel)
  end
end)

asset.onDeinitialize(function()
  for i = #moon_labels, 1, -1 do
    openspace.removeSceneGraphNode(moon_labels[i])
  end

  for i = #nodes, 1, -1 do
    openspace.removeSceneGraphNode(nodes[i])
  end
end)

for _, node in ipairs(nodes) do
  asset.export(node)
end



asset.meta = {
  Name = "Jupiter Ananke Group Moons",
  Version = "1.0",
  Description = [[Procedural Globe asset containing Jupiter's Ananke Group moons: S2010J2,
    Thelxinoe, Euanthe, Iocaste, S2003J16, Praxidike, Harpalyke, Mneme, Hermippe, Thyone,
    and Ananke. Blank globes and SPICE trails are generated for each moon]],
  Author = "OpenSpace Team",
  URL = "http://openspaceproject.com",
  License = "MIT license"
}
