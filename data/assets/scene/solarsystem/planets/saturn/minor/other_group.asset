local proceduralGlobes = asset.require("util/procedural_globe")
local transforms = asset.require("../transforms")
local kernels = asset.require("../kernels")
local kernel415 = kernels.sat415
local kernel441 = kernels.sat441
local kernel452 = kernels.sat452



local parentIdentifier = transforms.SaturnBarycenter.Identifier
local parentSpice = "SATURN BARYCENTER"
local tags = { "moon_solarSystem", "moon_giants", "moon_saturn", "moon_other", "moon_minor", "moon_minor_saturn" }
local trailColor = { 0.5, 0.3, 0.3 }
local trailTags = {
  "moonTrail_solarSystem",
  "moonTrail_giants",
  "moonTrail_saturn",
  "moonTrail_minor",
  "moonTrail_minor_saturn"
}

local otherGroup = {
  {
    Identifier = "Aegaeon",
    Parent = {
      Identifier = parentIdentifier,
      Spice = parentSpice
    },
    Spice = "AEGAEON",
    Radii = { 500, 500, 500 },
    Tags = tags,
    TrailTags = trailTags,
    GUI = {
      Path = "/Solar System/Planets/Saturn/Minor Moons/Other Group/Aegaeon"
    },
    TrailColor = trailColor,
    OrbitPeriod = 0.80812,
    Kernels = kernel415
  },
  {
    Identifier = "Methone",
    Parent = {
      Identifier = parentIdentifier,
      Spice = parentSpice
    },
    Spice = "METHONE",
    Radii = { 3200, 3200, 3200 },
    Tags = tags,
    TrailTags = trailTags,
    GUI = {
      Path = "/Solar System/Planets/Saturn/Minor Moons/Other Group/Methone"
    },
    TrailColor = trailColor,
    OrbitPeriod = 1.00957,
    Kernels = kernel415
  },
  {
    Identifier = "Anthe",
    Parent = {
      Identifier = parentIdentifier,
      Spice = parentSpice
    },
    Spice = "ANTHE",
    Radii = { 1800, 1800, 1800 },
    Tags = tags,
    TrailTags = trailTags,
    GUI = {
      Path = "/Solar System/Planets/Saturn/Minor Moons/Other Group/Anthe"
    },
    TrailColor = trailColor,
    OrbitPeriod = 1.05089,
    Kernels = kernel415
  },
  {
    Identifier = "Pallene",
    Parent = {
      Identifier = parentIdentifier,
      Spice = parentSpice
    },
    Spice = "PALLENE",
    Radii = { 6000, 6000, 4000 },
    Tags = tags,
    TrailTags = trailTags,
    GUI = {
      Path = "/Solar System/Planets/Saturn/Minor Moons/Other Group/Pallene"
    },
    TrailColor = trailColor,
    OrbitPeriod = 1.370218,
    Kernels = kernel415
  },
  {
    Identifier = "Telesto",
    Parent = {
      Identifier = parentIdentifier,
      Spice = parentSpice
    },
    Spice = "TELESTO",
    Radii = { 33000, 24000, 20000 },
    Tags = tags,
    TrailTags = trailTags,
    GUI = {
      Path = "/Solar System/Planets/Saturn/Minor Moons/Other Group/Telesto"
    },
    TrailColor = trailColor,
    OrbitPeriod = 1.887802,
    Kernels = kernel441
  },
  {
    Identifier = "Calypso",
    Parent = {
      Identifier = parentIdentifier,
      Spice = parentSpice
    },
    Spice = "CALYPSO",
    Radii = { 30000, 23000, 14000 },
    Tags = tags,
    TrailTags = trailTags,
    GUI = {
      Path = "/Solar System/Planets/Saturn/Minor Moons/Other Group/Calypso"
    },
    TrailColor = trailColor,
    OrbitPeriod = 1.887802,
    Kernels = kernel441
  },
  {
    Identifier = "Helene",
    Parent = {
      Identifier = parentIdentifier,
      Spice = parentSpice
    },
    Spice = "HELENE",
    Radii = { 43000, 38000, 26000 },
    Tags = tags,
    TrailTags = trailTags,
    GUI = {
      Path = "/Solar System/Planets/Saturn/Minor Moons/Other Group/Helene"
    },
    TrailColor = trailColor,
    OrbitPeriod = 2.736915,
    Kernels = kernel441
  },
  {
    Identifier = "Polydeuces",
    Parent = {
      Identifier = parentIdentifier,
      Spice = parentSpice
    },
    Spice = "POLYDEUCES",
    Radii = { 3000, 2000, 1000 },
    Tags = tags,
    TrailTags = trailTags,
    GUI = {
      Path = "/Solar System/Planets/Saturn/Minor Moons/Other Group/Polydeuces"
    },
    TrailColor = trailColor,
    OrbitPeriod = 2.736915,
    Kernels = kernel441
  },
  {
    Identifier = "S2004S24",
    Parent = {
      Identifier = parentIdentifier,
      Spice = parentSpice
    },
    Spice = "65070",
    Radii = { 3000, 3000, 3000 },
    Tags = tags,
    TrailTags = trailTags,
    GUI = {
      Name = "S/2004 S 24",
      Path = "/Solar System/Planets/Saturn/Minor Moons/Other Group/S2004S24"
    },
    TrailColor = trailColor,
    OrbitPeriod = 1293.85,
    Kernels = kernel452
  }
}

-- Generate all moon labels
local moon_labels = {}

for i, moon in ipairs(otherGroup) do
  local moonName = moon.GUI.Name or moon.Identifier
  moon_labels[i] = {
    Identifier = moon.Identifier .. "Label",
    Parent = moon.Identifier,
    Renderable = {
      Enabled = false,
      Type = "RenderableLabel",
      Text = moonName,
      FontSize = 70.0,
      Size = 5.5,
      MinMaxSize = { 1, 20 },
      OrientationOption = "Camera View Direction",
      BlendMode = "Additive",
      EnableFading = true,
      FadeUnit = "Mm",
      FadeDistances = { 250.0, 1500.0 },
      FadeWidths = { 100.0, 1500.0 }
    },
    Tag = { "solarsystem_labels", "moon_labels", "minor_moon_labels" },
    GUI = {
      Name = moonName .. " Label",
      Path = "/Solar System/Planets/Saturn/Minor Moons/Other Group/" .. moon.Identifier,
      Description = "Label for Saturn's moon " .. moonName .. " (other group)"
    }
  }
end

local nodes = proceduralGlobes.createGlobes(otherGroup)

asset.onInitialize(function()
  for _, node in ipairs(nodes) do
    openspace.addSceneGraphNode(node)
  end

  for _, moon in ipairs(moon_labels) do
    openspace.addSceneGraphNode(moon)
  end
end)

asset.onDeinitialize(function()
  for i = #moon_labels, 1, -1 do
    openspace.removeSceneGraphNode(moon_labels[i])
  end

  for i = #nodes, 1, -1 do
    openspace.removeSceneGraphNode(nodes[i])
  end
end)

for _, node in ipairs(nodes) do
  asset.export(node)
end


asset.meta = {
  Name = "Saturn Other Group Moons",
  Version = "1.0",
  Description = [[Procedural Globe asset containing Saturn's Other Group moons: Aegaeon,
    Methone, Anthe, Pallene, Telesto, Calypso, Helene, Polydeuces. Blank globes and SPICE
    trails are generated for each moon]],
  Author = "OpenSpace Team",
  URL = "http://openspaceproject.com",
  License = "MIT license"
}
