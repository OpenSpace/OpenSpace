local assetHelper = asset.require('util/asset_helper')
local kernels = asset.require('./kernels')
local marsTransforms = asset.require('scene/solarsystem/planets/mars/transforms')
local marsTransforms2 = asset.require('scene/solarsystem/planets/mars/mars')

--local sunTransforms = asset.require('scene/solarsystem/sun/transforms')

--local wheeldata = asset.syncedResource({
--    Name = "Wheel Data",
--    Type = "HttpSynchronization",
--    Identifier = "marscuriosity_wheeldata",
--    Version = 1
--})


local extra_rot = {
    Identifier = "extra_rot",
    Parent =  marsTransforms2.Mars.Identifier,
    TimeFrame = { -- Using Spice kernels for 1850-2150
        Type = "TimeFrameInterval",
        Start = "2013 AUG 22",
        End = "2018 JAN 24"
    },
    --Transform = {
    --    Rotation = {  --correct rotation for time "2013-08-22T05:44:00"
    --        Type = "StaticRotation",
    --        Rotation = { 1.0000000,  0.0000110, -0.0000120;
    --                      -0.0000110,  1.0000000,  0.0000000;
    --                       0.0000120,  0.0000000,  1.0000000
    --        }
    --    }
    --},
    GUI = {
        Path = "/Solar System/Planets/Mars/Curiosity/Model"
    }
}


local MSL_Rotation = {
    Identifier = "MSL_Rotation",
    Parent =  extra_rot.Identifier,
    --Transform = {
    --    Rotation = {
    --        Type = "StaticRotation",
    --        -- correct, no scalefactor
                --correct rotation for landing site: "2012-08-06T01:33:28", vi tror att det Ã¤r landing site
    --        --Rotation = { 0.9999998,  0.0006846, -0.0001692, 
    --        --            -0.0006846,  0.9999998,  0.0000001,
    --        --             0.0001692,  0.0000001,  1.0000000
    --        --}
    --        -- scalefactor
              --correct rotation for time "2013-08-22T05:44:00"
    --        Rotation = { 0.9999995,  0.0006493, -0.0008098, 
    --                    -0.0006493,  0.9999998,  0.0000003,
    --                     0.0008098,  0.0000003,  0.9999996
    --        }
    --    }
    --},
    GUI = {
        Path = "/Solar System/Planets/Mars/Curiosity/Model"
    }
}

local MSL_Location = {
    Identifier = "MSL_Location",
    Parent =  MSL_Rotation.Identifier,
    Transform = {   
        --Translation = {
        --    Type = "SpacecraftProjection",
        --    Target = "MSL",                 
        --    Observer = "MSL_LANDING_SITE",
        --    Frame = "MSL_TOPO",
        --    HeightTexture = "HeightmapTesting.jpg",                        
        --    Kernels = kernels.CuriosityKernels    
        --},
        Rotation = {
            Type = "SpiceRotation",
            SourceFrame = "MSL_ROVER",
            DestinationFrame = "IAU_MARS"   
        },
        Translation = {
            Type = "SpacecraftProjection",
            Target = "MSL",                 
            Observer = "MARS",
            Frame = "IAU_MARS",
            HeightTexture = "HeightmapTesting.jpg",                        
            Kernels = kernels.CuriosityKernels    
        }
    },
    GUI = {
        Path = "/Solar System/Planets/Mars/Curiosity/Model"
    }
}

local MSL_Body = {
    Identifier = "MSL_Body",
    Parent =  MSL_Location.Identifier,
    Transform = {   
        --Translation = {
        --    Type = "SpiceTranslation",
        --    Target = "MSL",
        --    Observer = "MSL_LANDING_SITE",
        --    Frame = "MSL_TOPO",
        --    Kernels = Kernels  
        --}
        --Scale = {
        --    Type = "StaticScale",
        --    Scale = 10.0
        --}
    },
    GUI = {
        Path = "/Solar System/Planets/Mars/Curiosity/Model"
    }
}



---- ROBOTIC ARM RA ----

local RA_Base_Location = {
    Identifier = "RA_Base_Location",
    Parent = MSL_Body.Identifier,
    Transform = {   
        Translation = {
            Type = "StaticTranslation",
            Position = { 1.111, -0.4525, -0.106 }
        },
        Rotation = {
            Type = "SpiceRotation",
            SourceFrame = "MSL_ROVER",
            DestinationFrame = "MSL_RA_BASE"
        }
    },
    GUI = {
        Path = "/Solar System/Planets/Mars/Curiosity/Model"
    }
}


--AZ
local RA_Shoulder_AZ_Location = {
    Identifier = "RA_Shoulder_AZ_Location",
    Parent = RA_Base_Location.Identifier,
    Transform = {   
        Rotation = {
            Type = "AdvancedSpiceRotation",
            SourceFrame = "MSL_RA_BASE",
            DestinationFrame = "MSL_RA_SHOULDER_AZ",
            RotationAxisSpice = 3,
            RotationAngleSpice = 3,
            RotationAxisStatic = 0,
            RotationAngle = 0.0,
            RotationDirectionSpice = false,
            RotationDirectionStatic = true,
            Kernels = kernels.CuriosityKernels
        },
        Translation = {
            Type = "StaticTranslation",
            Position = {0.0, 0.0, -0.08}
        }
    },
    GUI = {
        Path = "/Solar System/Planets/Mars/Curiosity/Model"
    }
}

----EL
local RA_Shoulder_EL_Location = {
    Identifier = "RA_Shoulder_EL_Location",
    Parent = RA_Shoulder_AZ_Location.Identifier,
    Transform = {
        Rotation = {
            Type = "AdvancedSpiceRotation",
            SourceFrame = "MSL_RA_SHOULDER_AZ",
            DestinationFrame = "MSL_RA_SHOULDER_EL",
            RotationAxisSpice = 2,
            RotationAngleSpice = 2,
            RotationAxisStatic = 0,
            RotationAngle = 0.0,
            RotationDirectionSpice = false,
            RotationDirectionStatic = true,
            Kernels = kernels.CuriosityKernels
        },
        Translation = {
            Type = "StaticTranslation",
            Position = {0.17, 0.2, -0.005}
        }
    },
    GUI = {
        Path = "/Solar System/Planets/Mars/Curiosity/Model"
    }
}

--ELBOW
local RA_Elbow_Location = {
    Identifier = "RA_Elbow_Location",
    Parent = RA_Shoulder_EL_Location.Identifier,
    Transform = {
        Rotation = {
            Type = "AdvancedSpiceRotation",
            SourceFrame = "MSL_RA_SHOULDER_EL",
            DestinationFrame = "MSL_RA_ELBOW",
            RotationAxisSpice = 2,
            RotationAngleSpice = 3,
            RotationAxisStatic = 2,
            RotationAngle = 0.0,
            RotationDirectionSpice = true,
            RotationDirectionStatic = true,
            Kernels = kernels.CuriosityKernels
        },
        Translation = {
            Type = "StaticTranslation",
            Position = {0.83, -0.2, 0.0 }
        }
    },
    GUI = {
        Path = "/Solar System/Planets/Mars/Curiosity/Model"
    }
}

--WRIST
local RA_Wrist_Location = {
    Identifier = "RA_Wrist_Location",
    Parent = RA_Elbow_Location.Identifier,
    Transform = {
        Rotation = {
            Type = "AdvancedSpiceRotation",
            SourceFrame = "MSL_RA_ELBOW",
            DestinationFrame = "MSL_RA_WRIST",
            RotationAxisSpice = 2,
            RotationAngleSpice = 3,
            RotationAxisStatic = 2,
            RotationAngle = 1.5708,
            RotationDirectionSpice = true,
            RotationDirectionStatic = true,
            Kernels = kernels.CuriosityKernels
        },
        Translation = {
            Type = "StaticTranslation",
            Position = {0.77, 0.13, 0.035}
        }
    },
    GUI = {
        Path = "/Solar System/Planets/Mars/Curiosity/Model"
    }
}

--TURRET
local RA_Turret_Location = {
    Identifier = "RA_Turret_Location",
    Parent = RA_Wrist_Location.Identifier,
    Transform = {
        Rotation = {
            Type = "AdvancedSpiceRotation",
            SourceFrame = "MSL_RA_TURRET",
            DestinationFrame = "MSL_MAHLI_REF",
            RotationAxisSpice = 1,
            RotationAngleSpice = 3,
            RotationAxisStatic = 1,
            RotationAngle = 0.882,
            RotationDirectionSpice = true,
            RotationDirectionStatic = true,
            Kernels = kernels.CuriosityKernels
        },
        Translation = {
            Type = "StaticTranslation",
            Position = {0.0, 0.04, -0.15}
        }
    },
    GUI = {
        Path = "/Solar System/Planets/Mars/Curiosity/Model"
    }
}

--MAHLI
local RA_Mahli_Location = {
    Identifier = "RA_Mahli_Location",
    Parent = RA_Turret_Location.Identifier
}


---- MASTCAM RSM ----
local RSM_ROOT_Location = {
    Identifier = "RSM_ROOT_Location",
    Parent = MSL_Body.Identifier,
    Transform = {
        Translation = {
            Type = "StaticTranslation",
            Position = {0.7039, 0.5769, -0.563}
        }
    },
    GUI = {
        Path = "/Solar System/Planets/Mars/Curiosity/Model"
    }
}

local RSM_AZ_Location = {
    Identifier = "RSM_AZ_Location",
    Parent = RSM_ROOT_Location.Identifier,
    Transform = {
        Rotation = {
            Type = "AdvancedSpiceRotation",
            SourceFrame = "MSL_ROVER", 
            DestinationFrame = "MSL_RSM_AZ",
            RotationAxisSpice = 0,
            RotationAngleSpice = 0,
            RotationAxisStatic = 3,
            RotationAngle = 3.1590,
            RotationDirectionSpice = true,
            RotationDirectionStatic = true,
            Kernels = kernels.CuriosityKernels
        },
        Translation = {
            Type = "StaticTranslation",
            Position = {0.0, 0.008, 0.0}
        }
    },
    GUI = {
        Path = "/Solar System/Planets/Mars/Curiosity/Model"
    }
}

local RSM_ZERO_EL_Location = {
    Identifier = "RSM_ZERO_EL_Location",
    Parent = RSM_AZ_Location.Identifier,
    GUI = {
        Path = "/Solar System/Planets/Mars/Curiosity/Model"
    }
}

local RSM_EL_Location = {
    Identifier = "RSM_EL_Location",
    Parent = RSM_AZ_Location.Identifier,
    Transform = {
        Rotation = {  
            Type = "AdvancedSpiceRotation",
            SourceFrame = "MSL_RSM_AZ",
            DestinationFrame = "MSL_RSM_EL",
            RotationAxisSpice = 0,
            RotationAngleSpice = 0,
            RotationAxisStatic = 2,
            RotationAngle = 0.7853981634,  
            RotationDirectionSpice = true,
            RotationDirectionStatic = true,
            Kernels = kernels.CuriosityKernels
        },
        Translation = {
            Type = "StaticTranslation",
            --Position = {0.0, 0.0, -0.664}
            Position = {0.002, 0.007, -0.688}   
        }
    },
    GUI = {
        Path = "/Solar System/Planets/Mars/Curiosity/Model"
    }
}



---- HIGH GAIN ANTENNA HGA ----

local HGA_AZ_Location = {
    Identifier = "HGA_AZ_Location",
    Parent = MSL_Body.Identifier,
    Transform = {   
        Rotation = {  
            Type = "AdvancedSpiceRotation",
            SourceFrame = "MSL_ROVER",
            DestinationFrame = "MSL_HGA_AZ",
            RotationAxisSpice = 3,
            RotationAngleSpice = 3,
            RotationAxisStatic = 0,
            RotationAngle = 0.0,
            RotationDirectionSpice = true,
            RotationDirectionStatic = true,
            Kernels = kernels.CuriosityKernels
        },
        Translation = {
            Type = "StaticTranslation",
            Position = {-0.46, -0.47, -0.55}
        }
    },
    GUI = {
        Path = "/Solar System/Planets/Mars/Curiosity/Model"
    }
}

local HGA_EL_Location = {
    Identifier = "HGA_EL_Location",
    Parent = HGA_AZ_Location.Identifier,
    Transform = {   
         Rotation = {  
            Type = "AdvancedSpiceRotation",
            SourceFrame = "MSL_HGA_AZ",
            DestinationFrame = "MSL_HGA_EL",
            RotationAxisSpice = 2,
            RotationAngleSpice = 3,
            RotationAxisStatic = 0,
            RotationAngle = 0.0,
            RotationDirectionSpice = false,
            RotationDirectionStatic = true,
            Kernels = kernels.CuriosityKernels
        },
        Translation = {
            Type = "StaticTranslation",
            Position = {0.0, 0.0, -0.17}
        }
    },
    GUI = {
        Path = "/Solar System/Planets/Mars/Curiosity/Model"
    }
}

---- SAM & HEMIN ----

local SAM_Cover_1_Location = {
    Identifier = "SAM_Cover_1_Location",
    Parent = MSL_Body.Identifier,
    GUI = {
        Path = "/Solar System/Planets/Mars/Curiosity/Model"
    }
}

local SAM_Cover_2_Location = {
    Identifier = "SAM_Cover_2_Location",
    Parent = MSL_Body.Identifier,
    GUI = {
        Path = "/Solar System/Planets/Mars/Curiosity/Model"
    }
}

local CHEMIN_Location = {
    Identifier = "CHEMIN_Location",
    Parent = MSL_Body.Identifier,
    GUI = {
        Path = "/Solar System/Planets/Mars/Curiosity/Model"
    }
}

---- Wheels ----

local Wheel_base_Location = {
    Identifier = "Wheel_base_Location",
    Parent = MSL_Body.Identifier,
    --Transform = {
    --    Rotation = {
    --        Type = "RksmlRotation",
    --        DataPath = wheeldata .. "/rksml/", 
    --        Object = "LEFT_BOGIE",
    --        RotationAxis = 1;
    --    }
    --},
    GUI = {
        Path = "/Solar System/Planets/Mars/Curiosity/Model"
    }
}

-- Left side --
local Leg_1_L_Location = {
    Identifier = "Leg_1_L_Location",
    Parent = Wheel_base_Location.Identifier,
    Transform = {   
        --Rotation = {
        --    Type = "RksmlRotation",
        --    DataPath = wheeldata .. "/rksml/", 
        --    Object = "LEFT_BOGIE",
        --    RotationAxis = 2;
        --},
        Translation = {
            Type = "StaticTranslation",
            --old Position = {0.185, -0.78, -0.22}
            Position = {0.217, -0.812, -0.215}   --for the right side
        }
    },
    GUI = {
        Path = "/Solar System/Planets/Mars/Curiosity/Model"
    }
}

-- local Leg_1B_L_Location = {
--     Identifier = "Leg_1B_L_Location",
--     Parent = Leg_1A_L_Location.Identifier,
--     Transform = {   
--         Translation = {
--             Type = "StaticTranslation",
--             Position = {0.0, 0.0, 0.0}
--         }
--     },
--     GUI = {
--         Path = "/Solar System/Planets/Mars/Curiosity/Model"
--     }
-- }

local Leg_2_L_Location = {
    Identifier = "Leg_2_L_Location",
    Parent = Leg_1_L_Location.Identifier,
    Transform = {   
        --Rotation = {
        --    Type = "RksmlRotation",
        --    DataPath = wheeldata .. "/rksml/", 
        --    Object = "LEFT_DIFFERENTIAL",
        --    RotationAxis = 2;
        --},
        Translation = {
            Type = "StaticTranslation",
            Position = {-0.74, -0.00380, 0.223} --CORRECT, DONT CHANGE
        }
    },
    GUI = {
        Path = "/Solar System/Planets/Mars/Curiosity/Model"
    }
}

local Wrist_F_L_Location = {
    Identifier = "Wrist_F_L_Location",
    Parent = Leg_1_L_Location.Identifier,
    Transform = {   
        --Rotation = {
        --    Type = "RksmlRotation",
        --    DataPath = wheeldata .. "/rksml/", 
        --    Object = "LF_STEER",
        --    RotationAxis = 3;
        --},
        Translation = {
            Type = "StaticTranslation",
            Position = {0.8839, -0.2659, 0.2} --CORRECT, DONT TOUCH
        }
    },
    GUI = {
        Path = "/Solar System/Planets/Mars/Curiosity/Model"
    }
}

local Wheel_F_L_Location = {
    Identifier = "Wheel_F_L_Location",
    Parent = Wrist_F_L_Location.Identifier,
    Transform = { 
        --Rotation = {
        --    Type = "RksmlRotation",
        --    DataPath = wheeldata .. "/rksml/", 
        --    Object = "LF_DRIVE",
        --    RotationAxis = 2;
        --}, 
        Translation = {
            Type = "StaticTranslation",
            Position = {0.0, 0.0, 0.426}
        }
    },
    GUI = {
        Path = "/Solar System/Planets/Mars/Curiosity/Model"
    }
}

local Wheel_C_L_Location = {
    Identifier = "Wheel_C_L_Location",
    Parent = Leg_2_L_Location.Identifier,
    Transform = {   
        --Rotation = {
        --    Type = "RksmlRotation",
        --    DataPath = wheeldata .. "/rksml/", 
        --    Object = "LM_DRIVE",
        --    RotationAxis = 2;
        --},
        Translation = {
            Type = "StaticTranslation",
            Position = {0.45, -0.4, 0.403}
        }
    },
    GUI = {
        Path = "/Solar System/Planets/Mars/Curiosity/Model"
    }
}


local Wrist_B_L_Location = {
    Identifier = "Wrist_B_L_Location",
    Parent = Leg_2_L_Location.Identifier,
    Transform = {   
        --Rotation = {
        --    Type = "RksmlRotation",
        --    DataPath = wheeldata .. "/rksml/", 
        --    Object = "LR_STEER",
        --    RotationAxis = 3;
        --},
        Translation = {
            Type = "StaticTranslation",
            Position = {-0.627, -0.2635, -0.022} --CORRECT, DONT CHANGE
        }
    },
    GUI = {
        Path = "/Solar System/Planets/Mars/Curiosity/Model"
    }
}


local Wheel_B_L_Location = {
    Identifier = "Wheel_B_L_Location",
    Parent = Wrist_B_L_Location.Identifier,
    Transform = {  
        --Rotation = {
        --    Type = "RksmlRotation",
        --    DataPath = wheeldata .. "/rksml/", 
        --    Object = "LR_DRIVE",
        --    RotationAxis = 2;
        --},
        Translation = {
            Type = "StaticTranslation",
            Position = {0.0, -0.0, 0.426}
        }
    },
    GUI = {
        Path = "/Solar System/Planets/Mars/Curiosity/Model"
    }
}


-- wheels, Right Side --

local Leg_1_R_Location = {
    Identifier = "Leg_1_R_Location",
    Parent = Wheel_base_Location.Identifier,
    Transform = {   
        --Rotation = {
        --    Type = "RksmlRotation",
        --    DataPath = wheeldata .. "/rksml/", 
        --    Object = "RIGHT_BOGIE",
        --    RotationAxis = 2;
        --},
        Translation = {
            Type = "StaticTranslation",
            Position = {0.217, 0.812, -0.215}   --Check with caroline!!!
        }
    },
    GUI = {
        Path = "/Solar System/Planets/Mars/Curiosity/Model"
    }
}

local Leg_2_R_Location = {
    Identifier = "Leg_2_R_Location",
    Parent = Leg_1_R_Location.Identifier,
    Transform = {   
        --Rotation = {
        --    Type = "RksmlRotation",
        --    DataPath = wheeldata .. "/rksml/", 
        --    Object = "RIGHT_DIFFERENTIAL",
        --    RotationAxis = 2;
        --},
        Translation = {
            Type = "StaticTranslation",
            --Position = {-0.74, 0.0, 0.24}
            Position = {-0.74, 0.00380, 0.223} --want to use this one, once the center point is changed in maya

        }
    },
    GUI = {
        Path = "/Solar System/Planets/Mars/Curiosity/Model"
    }
}

local Wrist_F_R_Location = {
    Identifier = "Wrist_F_R_Location",
    Parent = Leg_1_R_Location.Identifier,
    Transform = {  
        --Rotation = {
        --   Type = "RksmlRotation",
        --   DataPath = wheeldata .. "/rksml/", 
        --   Object = "RF_STEER",
        --   RotationAxis = 3;
        --}, 
        --Rotation = {
        --     Type = "StaticRotation",
        --     Rotation = { -1.0,  0.0, 0.0,
        --                   0.0,  -1.0,  0.0,
        --                    0.0,  0.0,  1.0
        --                 }
        -- },
        Translation = {
            Type = "StaticTranslation",
            Position = {0.882, 0.259, 0.215}
            --Position = {0.8839, 0.2659, 0.2} --position for the Wrist_F_L
        }
    },
    GUI = {
        Path = "/Solar System/Planets/Mars/Curiosity/Model"
    }
}


local Wheel_F_R_Location = {
    Identifier = "Wheel_F_R_Location",
    Parent = Wrist_F_R_Location.Identifier,
    Transform = {   
        --Rotation = {
        --    Type = "RksmlRotation",
        --    DataPath = wheeldata .. "/rksml/", 
        --    Object = "RF_DRIVE",
        --    RotationAxis = 2;
        --},
        Translation = {
            Type = "StaticTranslation",
            Position = {0.0, 0.0, 0.426}
        }
    },
    GUI = {
        Path = "/Solar System/Planets/Mars/Curiosity/Model"
    }
}

local Wheel_C_R_Location = {
    Identifier = "Wheel_C_R_Location",
    Parent = Leg_2_R_Location.Identifier,
    Transform = {  
        --Rotation = {
        --    Type = "RksmlRotation",
        --    DataPath = wheeldata .. "/rksml/", 
        --    Object = "RM_DRIVE",
        --    RotationAxis = 2;
        --}, 
        Translation = {
            Type = "StaticTranslation",
            Position = {0.45, 0.4, 0.403}
        }
    },
    GUI = {
        Path = "/Solar System/Planets/Mars/Curiosity/Model"
    }
}

local Wrist_B_R_Location = {
    Identifier = "Wrist_B_R_Location",
    Parent = Leg_2_R_Location.Identifier,
    Transform = {   
        --Rotation = {
        --    Type = "RksmlRotation",
        --    DataPath = wheeldata .. "/rksml/",  
        --    Object = "RR_STEER",
        --    RotationAxis = 3;
        --},
        Translation = {
            Type = "StaticTranslation",
            --Position = {-0.627, -0.2685, -0.022} --Position for Wrist_B_L
            Position = {-0.6208, 0.2759, -0.025}            
        }
    },
    GUI = {
        Path = "/Solar System/Planets/Mars/Curiosity/Model"
    }
}

local Wheel_B_R_Location = {
    Identifier = "Wheel_B_R_Location",
    Parent = Wrist_B_R_Location.Identifier,
    Transform = {
        --Rotation = {
        --    Type = "RksmlRotation",
        --    DataPath = wheeldata .. "/rksml/", 
        --    Object = "RR_DRIVE",
        --    RotationAxis = 2;
        --},   
        Translation = {
            Type = "StaticTranslation",
            Position = {0.0, -0.0005, 0.426}
        }
    },
    GUI = {
        Path = "/Solar System/Planets/Mars/Curiosity/Model"
    }
}

assetHelper.registerSceneGraphNodesAndExport(asset, { 
    --correctRotation,
    --centerMars,
    --landingSite,
    extra_rot,
    MSL_Rotation,
    MSL_Location,
    MSL_Body,
    RA_Base_Location,
    RA_Shoulder_AZ_Location,
    RA_Shoulder_EL_Location,
    RA_Elbow_Location,
    RA_Wrist_Location,
    RA_Turret_Location,
    RA_Mahli_Location,
    RSM_ROOT_Location,
    RSM_AZ_Location,
    RSM_ZERO_EL_Location,
    RSM_EL_Location,

    HGA_AZ_Location,
    HGA_EL_Location,
    SAM_Cover_1_Location,
    SAM_Cover_2_Location,
    CHEMIN_Location,

    Wheel_base_Location,
    Leg_1_L_Location,
    -- Leg_1B_L_Location,
    Leg_2_L_Location,
    Wrist_F_L_Location,
    Wheel_F_L_Location,
    Wheel_C_L_Location,
    Wrist_B_L_Location,
    Wheel_B_L_Location,

    Leg_1_R_Location,
    -- Leg_1B_R_Location,
    Leg_2_R_Location,
    Wrist_F_R_Location,
    Wheel_F_R_Location,
    Wheel_C_R_Location,
    Wrist_B_R_Location,
    Wheel_B_R_Location
})

