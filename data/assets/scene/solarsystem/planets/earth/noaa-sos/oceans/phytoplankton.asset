local globeIdentifier = asset.require("../../earth").Earth.Identifier


local Name = "Phytoplankton Model"
local Identifier = "noaa-sos-oceans-phytoplankton"
local Description = [[Phytoplankton are the base of the marine food web and are crucial
players in the Earth's carbon cycle. They are also incredibly diverse. This visualization
shows dominant phytoplankton types from 1994-1998 generated by the Darwin Project using a
high-resolution ocean and ecosystem model. The model contains flow fields from 1994-1999
(generated by the ECCO2 model), inorganic nutrients, 78 species of phytoplankton,
zooplankton, as well as particulate and dissolved organic matter. Colors represent the
most dominant type of phytoplankton at a given location based on their size and ability
to uptake nutrients. Red represents diatoms (big phytoplankton, which need silica),
yellow represents flagellates (other big phytoplankton), green represents prochlorococcus
(small phytoplankton that cannot use nitrate), and cyan represents synechococcus (other
small phytoplankton). Opacity indicates concentration of the phytoplankton as carbon
biomass]]
local URL = "https://sos.noaa.gov/catalog/datasets/phytoplankton-model/"


local syncedDirectory = asset.syncedResource({
  Name = Name,
  Type = "HttpSynchronization",
  Identifier = Identifier,
  Version = 1
})

local imagesDestination = syncedDirectory .. "images"

local layer = {
  Identifier = Identifier,
  Name = Name,
  Enabled = asset.enabled,
  Type = "ImageSequenceTileLayer",
  FolderPath = imagesDestination,
  Description = Description
}

local colorbar = {
  Identifier = Identifier,
  Name = Name,
  Enabled = asset.enabled,
  Type = "ScreenSpaceImageLocal",
  TexturePath = syncedDirectory .. "colorbar.png",
  FaceCamera = false,
  CartesianPosition = { 0.8, 0.0, -2.0 }
}

asset.onInitialize(function()
  if not openspace.directoryExists(imagesDestination) then
    openspace.printInfo("Extracting " .. Name)
    openspace.unzipFile(syncedDirectory .. "4096-1.zip", imagesDestination, true)
    openspace.unzipFile(syncedDirectory .. "4096-2.zip", imagesDestination, true)
    openspace.unzipFile(syncedDirectory .. "4096-3.zip", imagesDestination, true)
    openspace.unzipFile(syncedDirectory .. "4096-4.zip", imagesDestination, true)
    openspace.unzipFile(syncedDirectory .. "4096-5.zip", imagesDestination, true)
    openspace.unzipFile(syncedDirectory .. "4096-6.zip", imagesDestination, true)
    openspace.unzipFile(syncedDirectory .. "4096-7.zip", imagesDestination, true)
  end

  openspace.globebrowsing.addLayer(globeIdentifier, "ColorLayers", layer)
  openspace.addScreenSpaceRenderable(colorbar)
end)

asset.onDeinitialize(function()
  openspace.globebrowsing.deleteLayer(globeIdentifier, "ColorLayers", layer)
  openspace.removeScreenSpaceRenderable(colorbar)
end)

asset.export(layer)
asset.export(colorbar)


asset.meta = {
  Name = Name,
  Version = "1.0",
  Description = Description .. "Data provided by the National Oceanic and Atmospheric Administration",
  Author = "National Oceanic and Atmospheric Administration",
  URL = URL,
  License = "https://sos.noaa.gov/copyright/"
}
