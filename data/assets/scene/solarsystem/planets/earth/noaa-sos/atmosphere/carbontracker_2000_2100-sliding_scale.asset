local globeIdentifier = asset.require("./../../earth").Earth.Identifier


local Name = "CarbonTracker: Sliding Scale"
local Identifier = "noaa-sos-atmosphere-carbontracker_2000_2100-sliding_scale"
local Description = [[ "NOAA encourages science that adds benefit to society and the environment. CarbonTracker does both." said retired Navy Vice Admiral Conrad Lautenbacher, Ph.D., former undersecretary of commerce for oceans and atmosphere and NOAA administrator. CarbonTracker is a system to keep track of carbon dioxide uptake and release at the Earth's surface over time. It was developed by the Carbon Cycle Greenhouse Gases group at NOAA's Earth System Research Laboratory. As a scientific tool, CarbonTracker has helped improve the understanding of carbon uptake and release from the land and oceans, and how those sources and sinks are responding to the changing climate, increasing levels of atmospheric CO2 (the CO2 fertilization effect), and human management of land and oceans. CarbonTracker relies on the long-term monitoring of atmospheric CO2 performed by the NOAA Global Monitoring Division and international partners.]]
local URL = "https://sos.noaa.gov/catalog/datasets/carbon-tracker-sliding-scale/"


local syncedDirectory = asset.syncedResource({
	Name = Name,
	Type = "HttpSynchronization",
	Identifier = Identifier,
	Version = 1
})

local syncedDirectory_colorbar = asset.syncedResource({
	Name = Name .. " (Colorbar)",
	Type = "HttpSynchronization",
	Identifier = Identifier .. "-colorbar",
	Version = 1
})

local syncedDirectory_obs = asset.syncedResource({
	Name = Name .. " (OBS)",
	Type = "HttpSynchronization",
	Identifier = Identifier .. "-obs",
	Version = 1
})


local layer_field = {
  Identifier = Identifier .. "-field",
  Name = Name .. " (Field)",
  Type = "TemporalTileLayer",
  Mode = "Folder",
  Folder = {
    Folder = syncedDirectory,
    -- See https://en.cppreference.com/w/cpp/io/manip/get_time for an explanation of the
    -- time formatting string
    Format = "co2wx_%Y%m%d.png"
  },    
  Description = Description
}

local layer_obs = {
  Identifier = Identifier .. "-obs",
  Name = Name .. " (Observed)",
  Type = "TemporalTileLayer",
  Mode = "Folder",
  Folder = {
    Folder = syncedDirectory,
    -- See https://en.cppreference.com/w/cpp/io/manip/get_time for an explanation of the
    -- time formatting string
    Format = "co2wx_%Y%m%d.obs.png"
  },    
  Description = Description
}

local colorbar = {
  Identifier = Identifier,
  Name = Name,
  Type = "ScreenSpaceImageLocal",
  -- @TODO:  We need a temporal provider for ScreenSpaceImages to handle this
  TexturePath = syncedDirectory_colorbar .. "co2wx_20000101.cpt.png"
}

asset.onInitialize(function() 
  openspace.globebrowsing.addLayer(globeIdentifier, "ColorLayers", layer_field)
  openspace.globebrowsing.addLayer(globeIdentifier, "ColorLayers", layer_obs)
  openspace.addScreenSpaceRenderable(colorbar);  
end)

asset.onDeinitialize(function()
  openspace.globebrowsing.deleteLayer(globeIdentifier, "ColorLayers", layer_field.Identifier)
  openspace.globebrowsing.deleteLayer(globeIdentifier, "ColorLayers", layer_obs.Identifier)
  openspace.removeScreenSpaceRenderable(colorbar.Identifier)
end)


asset.meta = {
  Name = Name,
  Version = "1.0",
  Description = Description .. "Data provided by the National Oceanic and Atmospheric Administration.",
  Author = "National Oceanic and Atmospheric Administration",
  URL = URL,
  License = "https://sos.noaa.gov/copyright/"
}
