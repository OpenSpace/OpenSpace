-- local assetHelper = asset.require('util/asset_helper')
local sunTransforms = asset.require('scene/solarsystem/sun/transforms')
local earthTransforms = asset.require('scene/solarsystem/planets/earth/transforms')

local SdoTrail = {
    Identifier = "SolarImagery_SDO_Trail",
    Parent = earthTransforms.EarthInertial.Identifier,
    Renderable = {
        Type = "RenderableTrailOrbit",
        Translation = {
            Type = "SpiceTranslation",
            Frame = "J2000",
            Target = "-136395",
            Observer = "EARTH",
        },
        Color = { 1.0, 1.0, 1.0 },
        Period = 0.997319,
        Resolution = 1000
    },
    GUI = {
        Name = "Sdo Trail",
        Path = "/Solar System/Solar Imagery"
    }
}

-- Translate in Earth's coordinate system from earth's position
local Sdo = {
    Identifier = "Sdo",
    Parent = earthTransforms.EarthInertial.Identifier,
    Transform = {
        Translation = {
            Type = "SpiceTranslation",
            Target = "-136395",
            Observer = "EARTH",
            Frame = "J2000"
        },
        Rotation = {
            Type = "SpiceRotation",
            SourceFrame = "ECLIPJ2000",
            DestinationFrame = "J2000",
        }
    },
    GUI = {
        Name = "Sdo",
        Path = "/Solar System/Solar Imagery"
    }
}

local StereoA = {
    Identifier = "StereoA_Position",
    Parent = sunTransforms.SolarSystemBarycenter.Identifier,
    Transform = {
        Translation = {
            Type = "SpiceTranslation",
            Target = "-234",
            Observer = "SSB",
            Frame = "Galactic"
        },
        Rotation = {
            Type = "SpiceRotation",
            SourceFrame = "ECLIPJ2000",
            DestinationFrame = "GALACTIC",
        },
    },
    GUI = {
        Name = "Stereo A",
        Path = "/Solar System/Solar Imagery"
    }
}

local StereoImagery = {
    Identifier = "SolarImagery_STEREO-A_Image_EUV",
    Parent = StereoA.Identifier,
    Renderable = {
        -- Resolution of imagery, will be moved to metadata later
        Type = "RenderableSolarImagery",
        RootPath = asset.resource("solarbrowsing/imagedata/stereo-a_euvi-171"),
        TransferfunctionPath = asset.resource("solarbrowsing/colortables")
    },
    GUI = {
        Name = "EUV-I-A Imagery",
        Path = "/Solar System/Solar Imagery"
    }
}

local SdoImagery = {
    Identifier = "SolarImagery_SDO_Image_AIA",
    Parent = Sdo.Identifier,
    Renderable = {
        -- Resolution of imagery, will be moved to metadata later
        Type = "RenderableSolarImagery",
        RootPath = asset.resource("solarbrowsing/imagedata/sdo_aia-171"),
        TransferfunctionPath = asset.resource("solarbrowsing/colortables")
    },
    GUI = {
        Name = "SDO Imagery",
        Path = "/Solar System/Solar Imagery"
    }
}

local SunProjection = {
    Identifier = "SunProjection",
    Parent = sunTransforms.SunIAU.Identifier,
    Dependencies = {
        "SolarImagery_SDO_Image_AIA"
    },
    Renderable = {
        -- This is a really bad name
        Type = "RenderableSolarImageryProjection",
        DependentNodes = {
            "SolarImagery_SDO_Image_AIA",
            "SolarImagery_STEREO-A_Image_EUV"
        }
    },
    GUI = {
        Name = "Sun Projection",
        Path = "/Solar System/Imagery"
    }
}

-- stereo_kernels_bsp = asset.resource('kernels/STEREO-A_merged.bsp')


asset.onInitialize(function ()
    -- openspace.spice.loadKernel(stereo_kernels_bsp)

    openspace.addSceneGraphNode(SdoTrail)
    openspace.addSceneGraphNode(Sdo)
    openspace.addSceneGraphNode(SdoImagery)
    openspace.addSceneGraphNode(StereoA)
    openspace.addSceneGraphNode(StereoImagery)
    openspace.addSceneGraphNode(SunProjection)
end
)

asset.onDeinitialize(function ()
    openspace.removeSceneGraphNode(SunProjection)
    openspace.removeSceneGraphNode(SdoTrail)
    openspace.removeSceneGraphNode(SdoImagery)
    openspace.removeSceneGraphNode(Sdo)
    openspace.removeSceneGraphNode(StereoImagery)
    openspace.removeSceneGraphNode(StereoA)
end
)