--apollo_11_lem_flipbook.asset
local helper = asset.require('util/vrt_flipbook_helper')

local assetPrefix = "A11flip";
local assetGlobe = "Moon";
local flipbookCount = 19;

local flipbook = nil;

local vrts = asset.syncedResource({
    Name = "Apollo 11 Flipbook",
    Type = "HttpSynchronization",
    Identifier = "apollo_11_flipbook",
    Version = 1
})

openspace.printDebug("set up assetfor vrts:" .. vrts);


asset.onInitialize(function ()

--	openspace.setPropertyValueSingle("Scene.Moon.Renderable.Layers.ColorLayers.LRO_NAC_Apollo_11.Enabled", true)
--	openspace.setPropertyValueSingle("Scene.Moon.Renderable.Layers.HeightLayers.LRO_NAC_Apollo_11.Enabled", true)
-- openspace.setPropertyValueSingle("NavigationHandler.OrbitalNavigator.Aim", '')
-- openspace.setPropertyValueSingle("NavigationHandler.OrbitalNavigator.Anchor", 'Moon')
-- openspace.setPropertyValueSingle("NavigationHandler.OrbitalNavigator.RetargetAnchor", nil)
-- openspace.globebrowsing.goToGeo(0.6782993, 23.4664611, 2000)

	openspace.globebrowsing.addBlendingLayersFromDirectory(vrts, assetGlobe);

	flipbook = helper.createFlipbook(assetPrefix, assetGlobe, 19);

	function nextFlip() 
		openspace.printDebug("Goto next flip" .. flipbook.CurrentFlipIndex)
        helper.nextFlipbookPage(flipbook);
	end

	function previousFlip() 
        helper.previousFlipbookPage(flipbook);
	end

    openspace.bindKey("RIGHT", "nextFlip()")
    openspace.bindKey("LEFT", "previousFlip()")

end)


asset.onDeinitialize(function ()

	flipbook = nil;

    openspace.clearKey("RIGHT")
    openspace.clearKey("LEFT")

end)