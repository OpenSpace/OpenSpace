local coreKernels = asset.require("spice/core")
local kernels = asset.require("./kernels")
local sunTransforms = asset.require("scene/solarsystem/sun/transforms")



local MissionBegin = "2006 OCT 26 00:01:06"
local MissionEnd = "2026 FEB 11 19:51:09"

local StereoPosition = {
  Identifier = "StereoA_Position",
  Parent = sunTransforms.SolarSystemBarycenter.Identifier,
  Transform = {
    Translation = {
      Type = "SpiceTranslation",
      Target = kernels.ID.STEREO_A,
      Observer = coreKernels.ID.SolarSystemBarycenter,
    }
  },
  GUI = {
    Name = "STEREO Position",
    Path = "/Solar System/Missions/STEREO",
    Hidden = true,
    Focusable = false
  }
}

--Model from https://github.com/nasa/NASA-3D-Resources/tree/master/3D%20Models/Solar%20TErrestrial%20RElations%20Observatory%20(STEREO)
local StereoA = {
  Identifier = "StereoA_Model",
  Parent = StereoPosition.Identifier,
  Transform = {
    Rotation = {
      Type = "FixedRotation",
      Attached = "StereoA_Model",
      YAxis = sunTransforms.SunCenter.Identifier,
      ZAxis = { 0.0, 0.0, 1.0 },
      ZAxisOrthogonal = true,
    },
    TimeFrame = {
      Type = "TimeFrameInterval",
      Start = MissionBegin,
      End = MissionEnd
    }
  },
  Renderable = {
    Type = "RenderableModel",
    Body = "StereoA_Model",
    GeometryFile = asset.resource("STEREO.fbx"),
    LightSources = {sunTransforms.LightSource},
    AmbientIntensity = 0.2,
    SpecularIntensity = 0.0,
    ModelScale = 1
  },
  GUI = {
    Name = "STEREO Model",
    Path = "/Solar System/Missions/STEREO"
  }
}

local StereoTrail = {
  Identifier = "StereoA_Trail",
  Parent = sunTransforms.SolarSystemBarycenter.Identifier,
  Renderable = {
    Type = "RenderableTrailOrbit",
    Translation = {
      Type = "SpiceTranslation",
      Target = kernels.ID.STEREO_A,
      Observer = coreKernels.ID.SolarSystemBarycenter,
    },
    Color = {0.33, 0.75, 0.52 },
    Period = 346,
    Resolution = 5000,
    EnableFade = true,
    StartTime = MissionBegin,
    EndTime = MissionEnd,
  },
  GUI = {
    Name = "STEREO Trail",
    Path = "/Solar System/Missions/STEREO"
  }
}



asset.onInitialize(function()
  openspace.addSceneGraphNode(StereoPosition)
  openspace.addSceneGraphNode(StereoA)
  openspace.addSceneGraphNode(StereoTrail)
end)

asset.onDeinitialize(function()
  openspace.removeSceneGraphNode(StereoTrail)
  openspace.removeSceneGraphNode(StereoA)
  openspace.removeSceneGraphNode(StereoPosition)
end)

asset.export("Position", StereoPosition)
asset.export("StereoA", StereoA)
asset.export("Trail", StereoTrail)




asset.meta = {
  Name = "STEREO",
  Description = [[This asset adds the STEREO (Solar TErrestrial RElations Obervatory)
    Model, including the trajectory for the entire duration of the STEREO mission.]],
  Author = "OpenSpace Team",
  URL = "http://openspaceproject.com",
  License = "MIT license"
}
