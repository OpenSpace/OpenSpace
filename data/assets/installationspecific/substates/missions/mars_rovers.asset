local util = asset.require('./../../utility_functions')
local flyHome = asset.require('./../../fly_home_alternatives')

----------------------------------------------------------------
-- STATES
----------------------------------------------------------------
local marsTargetDistance = 7E6

local marsRoversState = {
  Identifier = "MarsRovers",
  Enter = [[
    ]] .. util.setOrbitSpeedFactor(0.4) .. [[
    ]] .. util.orbitOnArrival() .. [[
  ]],
  Exit = [[
    ]] .. util.stopOrbiting() .. [[
  ]]
}

local goToMarsOverview = [[
  ]] .. util.setCurveType("ZoomOutOverview") .. [[
  openspace.time.setPause(true)
  openspace.pathnavigation.goTo('Mars', true)
]]

-----
-- Curiosity
-----
local curiosityState = {
  Identifier = "Curiosity",
  Enter = [[
    ]] .. util.setOrbitSpeedFactor(0.4) .. [[
    ]] .. util.orbitOnArrival() .. [[
  ]],
  Exit = [[
    ]] .. util.stopOrbiting() .. [[
  ]]
}

-----
-- Perseverance
-----
local perseveranceState = {
  Identifier = "Perseverance",
  Enter = [[
    ]] .. util.setOrbitSpeedFactor(0.4) .. [[
    ]] .. util.orbitOnArrival() .. [[
  ]],
  Exit = [[
    ]] .. util.stopOrbiting() .. [[
  ]]
}

-----
-- MRO
-----
local mroState = {
  Identifier = "MRO",
  Enter = [[
    ]] .. util.setOrbitSpeedFactor(0.4) .. [[
    ]] .. util.orbitOnArrival() .. [[
  ]],
  Exit = [[
    ]] .. util.stopOrbiting() .. [[
  ]]
}

local states = {
  marsRoversState,
  curiosityState,
  perseveranceState,
  mroState
}

----------------------------------------------------------------
-- TRANSITIONS within this substate
----------------------------------------------------------------

local transitions = {
  -- Transition to/from this state
  {
    From = "Home",
    To = "MarsRovers",
    Action = goToMarsOverview
  },
  {
    From = "MarsRovers",
    To = "Home",
    Action = flyHome.cameraPath
  },
  -- Curiosity
  {
    From = "MarsRovers",
    To = "Curiosity"
  },
  {
    From = "Curiosity",
    To = "MarsRovers",
    Action = goToMarsOverview
  },
  {
    From = "Curiosity",
    To = "Perseverance",
  },
  {
    From = "Perseverance",
    To = "Curiosity",
  },
  {
    From = "Curiosity",
    To = "MRO",
  },
  {
    From = "MRO",
    To = "Curiosity",
  },
  -- Perseverance
  {
    From = "MarsRovers",
    To = "Perseverance",
    Action = [[]]
  },
  {
    From = "Perseverance",
    To = "MarsRovers",
    Action = goToMarsOverview
  },
  {
    From = "Perseverance",
    To = "MRO",
  },
  {
    From = "MRO",
    To = "Perseverance",
  },
  -- MRO
  {
    From = "MarsRovers",
    To = "MRO",
    Action = [[]]
  },
  {
    From = "MRO",
    To = "MarsRovers",
    Action = goToMarsOverview
  },
  -- Back to SolarSystem from substates
  {
    From = "Curiosity",
    To = "Home",
    Action = flyHome.cameraPath
  },
  {
    From = "Perseverance",
    To = "Home",
    Action = flyHome.cameraPath
  },
  {
    From = "MRO",
    To = "Home",
    Action = flyHome.cameraPath
  }
}

asset.export("states", states)
asset.export("transitions", transitions)
