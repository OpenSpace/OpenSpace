local util = asset.require('./../utility_functions')

----------------------------------------------------------------
-- SCENE GRAPH NODES
----------------------------------------------------------------

----------------------------------------------------------------
-- STATES
----------------------------------------------------------------
local marsTargetDistance = 7E6

local marsState = {
  Identifier = "Mars",
  Enter = [[
    ]] .. util.setOrbitSpeedFactor(0.4) .. [[
    ]] .. util.orbitOnArrival() .. [[
  ]],
  Exit = [[
    ]] .. util.stopOrbiting() .. [[
  ]]
}

-----
-- Valles Marineris
-----
local vallesMarinerisTargetDistance = 7E6

local vallesMarinerisState = {
  Identifier = "VallesMarineris",
  Enter = [[
    ]] .. util.setOrbitSpeedFactor(0.4) .. [[
    ]] .. util.orbitOnArrival() .. [[
  ]],
  Exit = [[
    ]] .. util.stopOrbiting() .. [[
  ]]
}

-----
-- Olympus Mons
-----
local olympusMonsTargetDistance = 7E6
local olympusMonsGeo = {
  lat = 18.65, lon = 226.2, height = 2e6
}

local olympusMonsNavState = [[{
  Anchor = "Mars",
  ReferenceFrame = "Mars",
  Position = { -2583495, -2316231, 824980.3125 },
  Up = { 0.5749897956848145, -0.3840242326259613, 0.7224348187446594 },
  Pitch = 1.0032713413238525,
  Yaw= -0.012328346259891987
}]];

local olympusMonsState = {
  Identifier = "OlympusMons",
  Enter = [[
    ]] .. util.setOrbitSpeedFactor(0.4) .. [[
    ]] .. util.orbitOnArrival() .. [[
  ]],
  Exit = [[
    ]] .. util.stopOrbiting() .. [[
  ]]
}

-----
-- Curiosity
-----
local curiosityTargetDistance = 7E6

local curiosityState = {
  Identifier = "Curiosity",
  Enter = [[
    ]] .. util.setOrbitSpeedFactor(0.4) .. [[
    ]] .. util.orbitOnArrival() .. [[
  ]],
  Exit = [[
    ]] .. util.stopOrbiting() .. [[
  ]]
}

local states = { marsState, vallesMarinerisState, olympusMonsState, curiosityState }

----------------------------------------------------------------
-- TRANSITIONS within this substate
----------------------------------------------------------------

local goToMarsOverview = [[
  ]] .. util.setCurveType("ZoomOutOverview") .. [[
  openspace.time.setPause(true)
  openspace.pathnavigation.goTo('Mars', true)
  ]] .. util.changeAnchor('Mars', 1) .. [[
]]

local goToVallesMarinerisTilted = [[
  ]] .. util.stopOrbiting() .. [[
  ]] .. util.setCurveType("AvoidCollisionWithLookAt") .. [[
  openspace.time.setPause(true)
  openspace.pathnavigation.generatePath({ 
      TargetType = "NavigationState", 
      NavigationState = ]] .. olympusMonsNavState .. [[
  })
]]

local transitions = {
  {
    From = "Mars",
    To = "VallesMarineris",
    Action = goToVallesMarinerisTilted
  },
  {
    From = "VallesMarineris",
    To = "Mars",
    Action = goToMarsOverview
  },
  {
    From = "Mars",
    To = "OlympusMons",
    Action = [[]]
  },
  {
    From = "OlympusMons",
    To = "Mars",
    Action = goToMarsOverview
  },
  {
    From = "Mars",
    To = "Curiosity",
    Action = [[]]
  },
  {
    From = "Curiosity",
    To = "Mars",
    Action = goToMarsOverview
  }
}

asset.export("states", states)
asset.export("transitions", transitions)
